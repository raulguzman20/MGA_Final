import{p as le,r as _,j as e,H as L,E as I,B as u,G as l,T as n}from"./index-D2WH0i0l.js";import{G as ae,u as O,w as ce}from"./GenericList-CZICF8vs.js";import{D as de}from"./DetailModal-BVuqfkLW.js";import{F as ue}from"./FormModal-BqkXggEq.js";import{S as pe}from"./SuccessAlert-D_Anh4KD.js";import"./Search-CIHESQ8V.js";import"./NavigateNext-C2-Nd8B6.js";import"./TableRow-CTBWTERd.js";import"./Stack-BupWGgAE.js";import"./Checkbox-4ec6YfyB.js";import"./Switch-qiKByfkr.js";import"./FormControlLabel-CLvj0mWI.js";const xe=()=>[{id:"ventas",label:"ID de Venta *",type:"text",required:!0,placeholder:"Ingrese el ID de la venta"},{id:"fechaPago",label:"Fecha de Pago *",type:"date",required:!0},{id:"metodoPago",label:"MÃ©todo de Pago *",type:"select",options:[{value:"Tarjeta",label:"Tarjeta"},{value:"Transferencia",label:"Transferencia"},{value:"Efectivo",label:"Efectivo"},{value:"PSE",label:"PSE"},{value:"Nequi",label:"Nequi"},{value:"Daviplata",label:"Daviplata"}],required:!0},{id:"valor_total",label:"Valor Total *",type:"number",required:!0,placeholder:"Ingrese el valor total del pago"},{id:"descripcion",label:"DescripciÃ³n",type:"text",required:!1,placeholder:"Ingrese una descripciÃ³n del pago (opcional)"},{id:"numeroTransaccion",label:"NÃºmero de TransacciÃ³n",type:"text",required:!1,placeholder:"Ingrese el nÃºmero de transacciÃ³n (opcional)"},{id:"estado",label:"Estado",type:"select",options:[{value:"pendiente",label:"Pendiente"},{value:"completado",label:"Completado"},{value:"fallido",label:"Fallido"},{value:"cancelado",label:"Cancelado"}],defaultValue:"completado"}],S=a=>{var N;let p=null;const c=(N=a.ventas)==null?void 0:N.beneficiario;return c&&typeof c=="object"&&(p={nombre:c.nombre||"",apellido:c.apellido||"",documento:c.numero_de_documento||c.numeroDocumento||"No disponible",telefono:c.telefono||"No disponible",email:c.email||c.correo||"",tipo_de_documento:c.tipoDocumento||c.tipo_de_documento||"",direccion:c.direccion||"",fechaDeNacimiento:c.fechaNacimiento||c.fecha_de_nacimiento||""}),p},W=a=>{var N;let p=null;const c=(N=a.ventas)==null?void 0:N.beneficiario;if(!c)return null;if(console.log("=== DEBUG GETCLIENTEINFO ==="),console.log("Bene:",c),console.log("ClienteId:",c.clienteId),console.log("Cliente info from backend:",c.cliente),c.cliente){console.log("Usando informaciÃ³n del cliente del backend");const g=c.cliente;p={nombre:g.nombre||"",apellido:g.apellido||"",documento:g.numeroDocumento||g.numero_de_documento||g.documento||"No disponible",telefono:g.telefono||"No disponible",tipo_de_documento:g.tipoDocumento||g.tipo_de_documento||g.tipoDocumento||""}}else console.log("No hay informaciÃ³n del cliente del backend"),p={nombre:"Cliente ID: "+(c.clienteId||"No disponible"),apellido:"",documento:c.clienteId||"No disponible",telefono:"No disponible",tipo_de_documento:"No disponible"};return console.log("Cliente final:",p),p},D=a=>{if(!a)return"No disponible";let p="";return a.nombre&&(p=a.nombre.trim(),a.apellido&&a.apellido.trim()!==""&&(p+=` ${a.apellido.trim()}`)),p||"Sin nombre"},R=a=>a?{transferencia_bancaria:"Transferencia",transferencia:"Transferencia",efectivo:"Efectivo",tarjeta:"Tarjeta",pse:"PSE",nequi:"Nequi",daviplata:"Daviplata"}[a.toLowerCase()]||a:"No disponible",Se=()=>{const{user:a}=le(),[p,c]=_.useState([]),[N,g]=_.useState(""),[P,y]=_.useState(null),[M,F]=_.useState(!1),[V,q]=_.useState(!1),[T,G]=_.useState(!1),[k,b]=_.useState({open:!1,message:""}),w=(a==null?void 0:a.role)==="cliente",U=s=>{console.log("=== VIEWING PAYMENT ==="),console.log("Payment data:",JSON.stringify(s,null,2)),s.es_grupo?y({...s,pagos_detalle:s.pagos}):y(s),F(!0)},z=()=>{F(!1),y(null)},J=s=>{const o={};return s.forEach(t=>{var m,h,j,C,f;const i=S(t),r=(i==null?void 0:i.documento)||((h=(m=t.ventas)==null?void 0:m.beneficiario)==null?void 0:h._id)||"sin_identificar",x=D(i);if(o[r]){if((C=(j=t.ventas)==null?void 0:j.beneficiario)!=null&&C.cliente&&!((f=o[r].beneficiario)!=null&&f.cliente)){const v=W(t);o[r].beneficiario={...o[r].beneficiario,cliente:v}}}else{const v=S(t),E=W(t);o[r]={_id:`grupo_${r}`,beneficiarioId:r,beneficiarioNombre:x,beneficiario:{...v,cliente:E},pagos:[],valor_total:0,cantidad_pagos:0,fecha_ultimo_pago:null,metodo_pago_principal:null,estado_principal:null,es_grupo:!0}}o[r].pagos.push(t),o[r].valor_total+=t.valor_total||0,o[r].cantidad_pagos+=1;const d=new Date(t.fechaPago||t.createdAt);(!o[r].fecha_ultimo_pago||d>new Date(o[r].fecha_ultimo_pago))&&(o[r].fecha_ultimo_pago=d),t.metodoPago&&(o[r].metodo_pago_principal||(o[r].metodo_pago_principal=t.metodoPago)),t.estado&&(o[r].estado_principal||(o[r].estado_principal=t.estado))}),Object.values(o).sort((t,i)=>i.valor_total-t.valor_total)},H=[{id:"beneficiario",label:"Beneficiario",render:(s,o)=>{if(o.es_grupo)return`${o.beneficiarioNombre} (${o.cantidad_pagos} pagos)`;const t=S(o);return D(t)}},{id:"valor_total",label:"Valor Total",render:(s,o)=>{var t;return o.es_grupo?`$${o.valor_total.toLocaleString("es-CO")}`:`$${(((t=o.ventas)==null?void 0:t.valor_total)||0).toLocaleString("es-CO")}`}},{id:"fechaPago",label:"Ãšltimo Pago",render:(s,o)=>o.es_grupo?o.fecha_ultimo_pago?new Date(o.fecha_ultimo_pago).toLocaleDateString("es-CO"):"No disponible":s?new Date(s).toLocaleDateString("es-CO"):"No disponible"},{id:"metodoPago",label:"MÃ©todo",render:(s,o)=>o.es_grupo?R(o.metodo_pago_principal):R(s)},{id:"estado",label:"Estado",render:(s,o)=>{const t=o.es_grupo?o.estado_principal:s;return{pendiente:"ðŸŸ¡ Pendiente",completado:"ðŸŸ¢ Completado",fallido:"ðŸ”´ Fallido",cancelado:"âš« Cancelado",pagado:"ðŸŸ¢ Pagado",anulado:"âš« Anulado"}[t]||t||"No disponible"}}],X=[{id:"historial",render:(s,o)=>{var x,d,m,h,j,C;if(console.log("=== RENDERING DETAIL ==="),console.log("Data received:",JSON.stringify(o,null,2)),o.es_grupo)return e.jsxs(u,{sx:{width:"100%",display:"flex",flexDirection:"column",padding:0,margin:0},children:[e.jsx(l,{container:!0,spacing:2,children:e.jsx(l,{item:!0,xs:12,children:e.jsxs(n,{variant:"h5",sx:{textAlign:"center",mb:3,color:"#0455a2",fontWeight:500},children:["Resumen de Pagos - ",o.beneficiarioNombre]})})}),e.jsxs(l,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(l,{item:!0,xs:6,children:e.jsxs(u,{sx:{p:1.5,backgroundColor:"#f9f9f9",borderRadius:"6px"},children:[e.jsx(n,{variant:"caption",sx:{color:"#666",fontWeight:600,display:"block",mb:.5},children:"Beneficiario:"}),e.jsx(n,{variant:"body1",sx:{fontWeight:600,color:"#333",mb:1},children:o.beneficiarioNombre}),((x=o.beneficiario)==null?void 0:x.telefono)&&e.jsxs(n,{variant:"caption",sx:{color:"#666",display:"block",mb:.5},children:["TelÃ©fono: ",o.beneficiario.telefono]}),((d=o.beneficiario)==null?void 0:d.email)&&e.jsxs(n,{variant:"caption",sx:{color:"#666",display:"block",mb:.5},children:["Email: ",o.beneficiario.email]}),((m=o.beneficiario)==null?void 0:m.documento)&&e.jsxs(n,{variant:"caption",sx:{color:"#666",display:"block",mb:.5},children:["Documento: ",o.beneficiario.documento]}),((h=o.beneficiario)==null?void 0:h.tipo_de_documento)&&e.jsxs(n,{variant:"caption",sx:{color:"#666",display:"block"},children:["Tipo de Documento: ",o.beneficiario.tipo_de_documento]})]})}),e.jsx(l,{item:!0,xs:6,children:e.jsxs(u,{sx:{p:1.5,backgroundColor:"#f9f9f9",borderRadius:"6px"},children:[e.jsx(n,{variant:"caption",sx:{color:"#666",fontWeight:600,display:"block",mb:.5},children:"Cliente:"}),(j=o.beneficiario)!=null&&j.cliente?e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"body1",sx:{fontWeight:600,color:"#333",mb:1},children:D(o.beneficiario.cliente)}),o.beneficiario.cliente.telefono&&e.jsxs(n,{variant:"caption",sx:{color:"#666",display:"block",mb:.5},children:["TelÃ©fono: ",o.beneficiario.cliente.telefono]}),o.beneficiario.cliente.documento&&e.jsxs(n,{variant:"caption",sx:{color:"#666",display:"block",mb:.5},children:["Documento: ",o.beneficiario.cliente.documento]}),o.beneficiario.cliente.tipo_de_documento&&e.jsxs(n,{variant:"caption",sx:{color:"#666",display:"block"},children:["Tipo de Documento: ",o.beneficiario.cliente.tipo_de_documento]})]}):e.jsx(n,{variant:"caption",sx:{color:"#666"},children:"No disponible"})]})})]}),e.jsxs(l,{container:!0,spacing:2,sx:{mb:2},children:[e.jsx(l,{item:!0,xs:3,children:e.jsxs(u,{sx:{p:1.5,backgroundColor:"#e8f5e8",borderRadius:"6px"},children:[e.jsx(n,{variant:"caption",sx:{color:"#666",fontWeight:600,display:"block",mb:.5},children:"Total Pagos:"}),e.jsx(n,{variant:"h6",sx:{fontWeight:700,color:"#2e7d32"},children:o.cantidad_pagos})]})}),e.jsx(l,{item:!0,xs:3,children:e.jsxs(u,{sx:{p:1.5,backgroundColor:"#e3f2fd",borderRadius:"6px"},children:[e.jsx(n,{variant:"caption",sx:{color:"#666",fontWeight:600,display:"block",mb:.5},children:"Valor Total:"}),e.jsxs(n,{variant:"h6",sx:{fontWeight:700,color:"#1976d2"},children:["$",o.valor_total.toLocaleString()]})]})}),e.jsx(l,{item:!0,xs:3,children:e.jsxs(u,{sx:{p:1.5,backgroundColor:"#fff3e0",borderRadius:"6px"},children:[e.jsx(n,{variant:"caption",sx:{color:"#666",fontWeight:600,display:"block",mb:.5},children:"Ãšltimo Pago:"}),e.jsx(n,{variant:"h6",sx:{fontWeight:700,color:"#f57c00"},children:o.fecha_ultimo_pago?new Date(o.fecha_ultimo_pago).toLocaleDateString("es-CO"):"No disponible"})]})}),e.jsx(l,{item:!0,xs:3,children:e.jsxs(u,{sx:{p:1.5,backgroundColor:"#f3e5f5",borderRadius:"6px"},children:[e.jsx(n,{variant:"caption",sx:{color:"#666",fontWeight:600,display:"block",mb:.5},children:"Estado Principal:"}),e.jsx(n,{variant:"h6",sx:{fontWeight:700,color:"#7b1fa2"},children:o.estado_principal||"No disponible"})]})})]}),e.jsx(l,{container:!0,spacing:2,sx:{mb:2},children:e.jsx(l,{item:!0,xs:12,children:e.jsxs(u,{sx:{p:2,backgroundColor:"#fafafa",borderRadius:"8px"},children:[e.jsx(n,{variant:"h6",sx:{mb:2,color:"#666",fontWeight:600},children:"Detalle de Pagos:"}),o.pagos_detalle&&o.pagos_detalle.map((f,v)=>e.jsx(u,{sx:{p:1.5,mb:1,border:"1px solid #e0e0e0",borderRadius:"4px",backgroundColor:"#fff"},children:e.jsxs(l,{container:!0,spacing:1,children:[e.jsxs(l,{item:!0,xs:2,children:[e.jsx(n,{variant:"caption",sx:{color:"#666",fontWeight:500,display:"block",mb:.5},children:"Fecha:"}),e.jsx(n,{variant:"body2",sx:{fontWeight:600,color:"#333",fontSize:"0.75rem"},children:f.fechaPago?new Date(f.fechaPago).toLocaleDateString("es-CO"):"No disponible"})]}),e.jsxs(l,{item:!0,xs:3,children:[e.jsx(n,{variant:"caption",sx:{color:"#666",fontWeight:500,display:"block",mb:.5},children:"Valor:"}),e.jsxs(n,{variant:"body2",sx:{fontWeight:600,color:"#1976d2",fontSize:"0.75rem"},children:["$",(f.valor_total||0).toLocaleString()]})]}),e.jsxs(l,{item:!0,xs:4,children:[e.jsx(n,{variant:"caption",sx:{color:"#666",fontWeight:500,display:"block",mb:.5},children:"MÃ©todo:"}),e.jsx(n,{variant:"body2",sx:{fontWeight:600,color:"#333",fontSize:"0.75rem",wordBreak:"break-word",overflow:"hidden",textOverflow:"ellipsis"},children:R(f.metodoPago)})]}),e.jsxs(l,{item:!0,xs:3,children:[e.jsx(n,{variant:"caption",sx:{color:"#666",fontWeight:500,display:"block",mb:.5},children:"Estado:"}),e.jsx(n,{variant:"body2",sx:{fontWeight:600,color:"#2e7d32",fontSize:"0.75rem"},children:f.estado||"No disponible"})]})]})},f._id||v))]})})})]});const t=S(o),i=W(o),r=D(t);return e.jsxs(u,{sx:{width:"100%",display:"flex",flexDirection:"column",padding:0,margin:0},children:[e.jsx(l,{container:!0,spacing:2,children:e.jsx(l,{item:!0,xs:12,children:e.jsx(n,{variant:"h5",sx:{textAlign:"center",mb:3,color:"#0455a2",fontWeight:500},children:"Detalle del Pago"})})}),e.jsxs(l,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(l,{item:!0,xs:6,children:e.jsxs(u,{sx:{p:2,backgroundColor:"#f9f9f9",borderRadius:"8px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#666",mb:1},children:"Beneficiario:"}),e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:r}),(t==null?void 0:t.telefono)&&e.jsxs(n,{variant:"body2",sx:{color:"#666",mt:1},children:["TelÃ©fono: ",t.telefono]}),(t==null?void 0:t.email)&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Email: ",t.email]}),(t==null?void 0:t.documento)&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Documento: ",t.documento]}),(t==null?void 0:t.tipo_de_documento)&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Tipo de Documento: ",t.tipo_de_documento]})]})}),e.jsx(l,{item:!0,xs:6,children:e.jsxs(u,{sx:{p:2,backgroundColor:"#f9f9f9",borderRadius:"8px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#666",mb:1},children:"Cliente:"}),i?e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:D(i)}),i.telefono&&e.jsxs(n,{variant:"body2",sx:{color:"#666",mt:1},children:["TelÃ©fono: ",i.telefono]}),i.documento&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Documento: ",i.documento]}),i.tipo_de_documento&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Tipo de Documento: ",i.tipo_de_documento]})]}):e.jsx(n,{variant:"body2",sx:{color:"#666"},children:"No disponible"})]})})]}),e.jsxs(l,{container:!0,spacing:2,sx:{mb:3},children:[e.jsx(l,{item:!0,xs:4,children:e.jsxs(u,{sx:{p:2,backgroundColor:"#f9f9f9",borderRadius:"8px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#666",mb:1},children:"Fecha:"}),e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:o.fechaPago?new Date(o.fechaPago).toLocaleDateString("es-CO"):"No disponible"})]})}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(u,{sx:{p:2,backgroundColor:"#f9f9f9",borderRadius:"8px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#666",mb:1},children:"MÃ©todo:"}),e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:o.metodoPago||"No disponible"})]})}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(u,{sx:{p:2,backgroundColor:"#f9f9f9",borderRadius:"8px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#666",mb:1},children:"Estado:"}),e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:o.estado?o.estado.charAt(0).toUpperCase()+o.estado.slice(1):"No disponible"})]})})]}),(o.descripcion||o.numeroTransaccion)&&e.jsxs(l,{container:!0,spacing:2,sx:{mb:3},children:[o.descripcion&&e.jsx(l,{item:!0,xs:12,children:e.jsxs(u,{sx:{p:2,backgroundColor:"#f9f9f9",borderRadius:"8px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#666",mb:1},children:"DescripciÃ³n:"}),e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:o.descripcion})]})}),o.numeroTransaccion&&e.jsx(l,{item:!0,xs:12,children:e.jsxs(u,{sx:{p:2,backgroundColor:"#f9f9f9",borderRadius:"8px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#666",mb:1},children:"NÃºmero de TransacciÃ³n:"}),e.jsx(n,{variant:"body1",sx:{fontWeight:500},children:o.numeroTransaccion})]})})]}),o.ventas&&e.jsx(l,{container:!0,spacing:2,sx:{mb:3},children:e.jsx(l,{item:!0,xs:12,children:e.jsxs(u,{sx:{p:2,backgroundColor:"#e3f2fd",borderRadius:"8px"},children:[e.jsx(n,{variant:"subtitle2",sx:{color:"#666",mb:1},children:"InformaciÃ³n de la Venta:"}),e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["ID: ",o.ventas._id||"No disponible"]}),o.ventas.codigoVenta&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["CÃ³digo: ",o.ventas.codigoVenta]}),o.ventas.tipo&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Tipo: ",o.ventas.tipo]}),o.ventas.estado&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Estado: ",o.ventas.estado]}),o.ventas.valor_total&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Valor Venta: $",o.ventas.valor_total.toLocaleString()]}),o.ventas.fechaInicio&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Fecha Inicio: ",new Date(o.ventas.fechaInicio).toLocaleDateString("es-CO")]}),o.ventas.fechaFin&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Fecha Fin: ",new Date(o.ventas.fechaFin).toLocaleDateString("es-CO")]}),o.ventas.numero_de_clases&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["NÃºmero de Clases: ",o.ventas.numero_de_clases]}),o.ventas.ciclo&&e.jsxs(n,{variant:"body2",sx:{color:"#666"},children:["Ciclo: ",o.ventas.ciclo]})]})})}),e.jsx(l,{container:!0,sx:{mt:3},children:e.jsx(l,{item:!0,xs:12,children:e.jsx(u,{sx:{p:2,borderTop:"1px solid #eee",display:"flex",justifyContent:"flex-start"},children:e.jsxs(n,{variant:"h6",sx:{color:"#0455a2"},children:["Valor Total: $",(C=o.ventas)!=null&&C.valor_total?o.ventas.valor_total.toLocaleString():"0"]})})})})]})}}],K=()=>{try{console.log("=== EXPORTING TO EXCEL CORREGIDO ===");const s=O.book_new(),o=[["Beneficiario","Cantidad Pagos","Valor Total","Ãšltimo Pago","MÃ©todo Pago","Estado","Documento Beneficiario","TelÃ©fono Beneficiario"],...p.map(i=>{var r,x;if(i.es_grupo)return[i.beneficiarioNombre,i.cantidad_pagos,i.valor_total,i.fecha_ultimo_pago?new Date(i.fecha_ultimo_pago).toLocaleDateString("es-CO"):"No disponible",i.metodo_pago_principal||"No disponible",i.estado_principal||"No disponible",((r=i.beneficiario)==null?void 0:r.documento)||"No disponible",((x=i.beneficiario)==null?void 0:x.telefono)||"No disponible"];{const d=S(i);return[D(d),1,i.valor_total||0,i.fechaPago?new Date(i.fechaPago).toLocaleDateString("es-CO"):"No disponible",i.metodoPago||"No disponible",i.estado||"No disponible",(d==null?void 0:d.documento)||"No disponible",(d==null?void 0:d.telefono)||"No disponible"]}})],t=O.aoa_to_sheet(o);O.book_append_sheet(s,t,"Pagos Agrupados"),ce(s,"pagos_agrupados.xlsx"),b({open:!0,message:"Archivo Excel exportado correctamente"})}catch(s){console.error("Error exporting to Excel:",s),b({open:!0,message:"Error al exportar archivo Excel"})}},B=async()=>{try{console.log("=== FETCHING PAGOS ===");const s=`${L.BASE_URL}/pagos`,o=await I.get(s,{headers:{Authorization:`Bearer ${(a==null?void 0:a.token)||localStorage.getItem("token")}`}});if(console.log("API Response:",o.data),o.data&&o.data.success){let t=o.data.data.map(r=>{var x,d;return{...r,valor_total:r.valor_total||((x=r.ventas)==null?void 0:x.valor_total)||0,valorTotal:r.valor_total||((d=r.ventas)==null?void 0:d.valor_total)||0}});t.length===0&&w&&b({open:!0,message:"No tienes pagos registrados"}),console.log("Pagos recibidos:",t);const i=J(t);c(i),console.log("Payments agrupados:",i)}}catch(s){console.error("Error fetching pagos:",s),b({open:!0,message:"Error al cargar los pagos"})}};_.useEffect(()=>{console.log("=== COMPONENT MOUNTED ==="),B()},[w,a==null?void 0:a.documento]);const Y=async s=>{var o,t;try{console.log("=== FORM SUBMIT ==="),console.log("isEditing:",T),console.log("formData:",JSON.stringify(s,null,2));const r=["venta","fechaPago","metodoPago","valor_total"].filter(m=>{const h=s[m];return!h||h.toString().trim()===""});if(r.length>0){b({open:!0,message:`Los campos ${r.join(", ")} son obligatorios`});return}const x={ventas:s.ventas.trim(),fechaPago:s.fechaPago,metodoPago:s.metodoPago,valor_total:parseFloat(s.valor_total)||0,estado:s.estado||"completado",descripcion:(s.descripcion||"").trim(),numeroTransaccion:(s.numeroTransaccion||"").trim()};console.log("Prepared payment data:",JSON.stringify(x,null,2));const d={headers:{"Content-Type":"application/json",Authorization:`Bearer ${(a==null?void 0:a.token)||localStorage.getItem("token")}`},timeout:1e4};if(T){const m=`${L.BASE_URL}/pagos/${P._id}`;console.log(`Making PUT request to: ${m}`),await I.put(m,x,d),b({open:!0,message:"Pago actualizado correctamente"})}else{const m=`${L.BASE_URL}/pagos`;console.log(`Making POST request to: ${m}`),await I.post(m,x,d),b({open:!0,message:"Pago creado correctamente"})}await B(),$()}catch(i){console.error("=== SUBMIT ERROR ==="),console.error("Error:",i);let r="Error al guardar el pago";(t=(o=i.response)==null?void 0:o.data)!=null&&t.message?r=i.response.data.message:i.message&&(r=i.message),b({open:!0,message:r})}},$=()=>{q(!1),y(null),G(!1)},Q=()=>{b({...k,open:!1})};return console.log("=== RENDER ==="),console.log("Payments count:",p.length),e.jsxs(e.Fragment,{children:[e.jsx(ae,{data:p,columns:H,rowKey:"_id",onView:U,onExportPdf:K,title:"GestiÃ³n de Pagos",showEditButton:!1,showDeleteButton:!1,showCreateButton:!1,showViewButton:!0,customSearch:(s,o)=>{var f,v,E,A;const t=(o||"").toString().toLowerCase().trim();if(!t)return!0;if(s.es_grupo){const Z=(s.beneficiarioNombre||"").toLowerCase(),ee=(((f=s.beneficiario)==null?void 0:f.documento)||"").toLowerCase(),oe=(((v=s.beneficiario)==null?void 0:v.telefono)||"").toLowerCase(),te=(s.estado_principal||"").toString().toLowerCase(),ne=(s.metodo_pago_principal||"").toString().toLowerCase(),ie=s.fecha_ultimo_pago?new Date(s.fecha_ultimo_pago).toLocaleDateString("es-CO").toLowerCase():"",se=(s.valor_total||0).toString(),re=(s.cantidad_pagos||0).toString();return Z.includes(t)||ee.includes(t)||oe.includes(t)||te.includes(t)||ne.includes(t)||ie.includes(t)||se.includes(t)||re.includes(t)}const i=(E=s.ventas)==null?void 0:E.beneficiario,r=i?`${(i.nombre||"").trim()} ${(i.apellido||"").trim()}`.trim().toLowerCase():"",x=((i==null?void 0:i.numero_de_documento)||(i==null?void 0:i.numeroDocumento)||(i==null?void 0:i.documento)||"").toLowerCase(),d=((i==null?void 0:i.telefono)||"").toLowerCase(),m=(s.metodoPago||"").toString().toLowerCase(),h=(s.estado||"").toString().toLowerCase(),j=s.fechaPago?new Date(s.fechaPago).toLocaleDateString("es-CO").toLowerCase():"",C=(s.valor_total||((A=s.ventas)==null?void 0:A.valor_total)||0).toString();return r.includes(t)||x.includes(t)||d.includes(t)||m.includes(t)||h.includes(t)||j.includes(t)||C.includes(t)}}),e.jsx(de,{title:`Detalle del Pago: ${(P==null?void 0:P._id)||"N/A"}`,data:P,fields:X,open:M,onClose:z,maxWidth:"md",fullWidth:!0}),e.jsx(ue,{title:T?"Editar Pago":"Crear Nuevo Pago",fields:xe(),initialData:P,open:V,onClose:$,onSubmit:Y,maxWidth:"md",fullWidth:!0}),e.jsx(pe,{open:k.open,message:k.message,onClose:Q})]})};export{Se as default};
