import{r as s,j as r,E as c}from"./index-D2WH0i0l.js";import{G,F as I}from"./formModal2-DqC9aShG.js";import{D as z}from"./DetailModal-BVuqfkLW.js";import{S}from"./StatusButton-T52DgIHd.js";import{S as R}from"./SuccessAlert-D_Anh4KD.js";import{C as k}from"./ConfirmationDialog-BkQTGDdL.js";import"./Search-CIHESQ8V.js";import"./NavigateNext-C2-Nd8B6.js";import"./TableRow-CTBWTERd.js";import"./Stack-BupWGgAE.js";import"./Checkbox-4ec6YfyB.js";import"./Switch-qiKByfkr.js";import"./FormControlLabel-CLvj0mWI.js";import"./EventNote-C1bQThfN.js";const se=()=>{const[b,u]=s.useState([]),[o,i]=s.useState(null),[y,x]=s.useState(!1),[w,p]=s.useState(!1),[m,f]=s.useState(!1),[h,t]=s.useState({open:!1,message:""}),[j,g]=s.useState(!1),[d,v]=s.useState(null),D=[{id:"numeroAula",label:"Número de Aula"},{id:"capacidad",label:"Capacidad"},{id:"estado",label:"Estado",render:(e,a)=>r.jsx(S,{active:e==="Activo",onClick:()=>O(a._id)}),filter:{type:"select",options:[{value:"Todos",label:"Todos"},{value:"Activo",label:"Activos"},{value:"Inactivo",label:"Inactivos"}],defaultValue:"Todos"}}],F=[{id:"numeroAula",label:"Número de Aula"},{id:"capacidad",label:"Capacidad",render:e=>`${e} beneficiarios`},{id:"estado",label:"Estado",render:e=>r.jsx(S,{active:e==="Activo"})}],M=[{id:"numeroAula",label:"Número de Aula",type:"text",required:!0,disabled:m},{id:"capacidad",label:"Capacidad",type:"number",required:!0,min:1,max:50,helperText:"Mínimo 1, máximo 50 beneficiarios",validateOnChange:!0,validate:e=>{const a=parseInt(e);return a<1?"La capacidad debe ser al menos 1":a>50?"La capacidad no puede exceder 50":null}},{id:"estado",label:"Estado",type:"switch",defaultValue:"Activo"}],A=async()=>{try{const e=await c.get("http://localhost:3000/api/aulas");u(e.data)}catch(e){console.error("Error fetching aulas:",e),t({open:!0,message:"Error al cargar las aulas"})}};s.useEffect(()=>{A()},[]);const O=async e=>{try{const a=b.find(n=>n._id===e);if(!a)return;const l=a.estado==="Activo"?"Inactivo":"Activo";u(n=>n.map(E=>E._id===e?{...E,estado:l}:E)),await c.put(`http://localhost:3000/api/aulas/${e}`,{...a,estado:l}),t({open:!0,message:"Estado actualizado correctamente"})}catch(a){u(l=>l.map(n=>n._id===e?{...n,estado:aula.estado}:n)),console.error("Error updating aula status:",a),t({open:!0,message:"Error al actualizar el estado"})}},T=e=>{v(e),g(!0)},_=async()=>{var e;if(d)try{const a=await c.delete(`http://localhost:3000/api/aulas/${d._id}`);await A(),t({open:!0,message:"Aula eliminada correctamente"})}catch(a){console.error("Error deleting aula:",a),((e=a.response)==null?void 0:e.status)===400?t({open:!0,message:a.response.data.message||"No se puede eliminar el aula porque está asociada a programaciones de clases"}):t({open:!0,message:"Error al eliminar el aula"})}finally{g(!1),v(null)}},$=async e=>{try{const a=parseInt(e.capacidad);if(a<1||a>50){t({open:!0,message:"La capacidad debe estar entre 1 y 50 beneficiarios"});return}const l={numeroAula:e.numeroAula,capacidad:a,estado:e.estado||"Activo"};m&&(o!=null&&o._id)?(await c.put(`http://localhost:3000/api/aulas/${o._id}`,l),t({open:!0,message:"Aula editada correctamente"})):(await c.post("http://localhost:3000/api/aulas",l),t({open:!0,message:"Aula creada correctamente"})),await A(),C()}catch(a){console.error("Error saving aula:",a),t({open:!0,message:"Error al guardar el aula"})}},N=()=>{f(!1),i(null),p(!0)},V=e=>{f(!0),i(e),p(!0)},q=e=>{i(e),x(!0)},L=()=>{x(!1),i(null)},C=()=>{p(!1),i(null),f(!1)},B=()=>{t({...h,open:!1})};return r.jsxs(r.Fragment,{children:[r.jsx(G,{data:b,columns:D,onEdit:V,onDelete:T,onCreate:N,onView:q,title:"Gestión de Aulas",enableFilters:!0}),r.jsx(z,{title:`Detalle del Aula ${o==null?void 0:o.numeroAula}`,data:o,fields:F,open:y,onClose:L,sx:{borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.08)",overflow:"hidden",width:"40%",height:"50%",maxHeight:"50vh"}}),r.jsx(I,{title:m?"Editar Aula":"Crear Nueva Aula",fields:M,initialData:o,open:w,onClose:C,onSubmit:$}),r.jsx(k,{open:j,title:"Confirmar Eliminación",content:`¿Está seguro que desea eliminar el aula ${d==null?void 0:d.numeroAula}?


Esta acción no se puede deshacer. Si el aula está asociada a programaciones de clases, no se podrá eliminar.`,onConfirm:_,onClose:()=>g(!1),confirmButtonColor:"#f44336",confirmButtonText:"Eliminar"}),r.jsx(R,{open:h.open,message:h.message,onClose:B})]})};export{se as default};
