import{r as m,j as e,a0 as te,a7 as le,B as x,I as N,a1 as ce,a2 as de,G as t,F as D,q as C,S,M as b,T as d,y as W,c as A,a8 as he,P,b as V,A as G,a9 as xe,C as pe,a3 as ue}from"./index-D2WH0i0l.js";import{C as me}from"./CalendarMonth-D4CxqV-i.js";import{A as fe}from"./Add-BsbvM-9j.js";import{D as ge}from"./Search-CIHESQ8V.js";import{I as J}from"./InputAdornment-RiOQfDiX.js";import{T as X}from"./AccessTime-BdvwmUhM.js";const Se=({isOpen:F,onClose:_,onSubmit:K,profesores:U=[],defaultProfesorId:k="",defaultHorariosPorDia:H=[],defaultEstado:M="activo",defaultMotivo:L="",isEditing:p=!1})=>{const[$,z]=m.useState(!1),[i,f]=m.useState({profesorId:"",estado:"activo",motivo:"",horariosPorDia:[]}),[l,j]=m.useState({}),[g,v]=m.useState([]),[h,y]=m.useState({horaInicio:"09:00",horaFin:"17:00"}),[I,u]=m.useState({open:!1,message:"",severity:"success"}),w={L:"Lunes",M:"Martes",X:"Miércoles",J:"Jueves",V:"Viernes",S:"Sábado",D:"Domingo"},O=["L","M","X","J","V","S","D"],R=["06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"];m.useEffect(()=>{if(F){const r=k||i.profesorId||"";f({profesorId:r,estado:p?M:"activo",motivo:L||"",horariosPorDia:H.length>0?[...H]:[]}),j({}),v([]),y({horaInicio:"09:00",horaFin:"17:00"})}},[F,k,H,M,L,p]);const T=(r,o)=>{console.log(`Cambiando ${r} a:`,o),f(a=>({...a,[r]:o})),l[r]&&j(a=>({...a,[r]:""}))},Q=r=>{const o=g.includes(r);v(o?a=>a.filter(c=>c!==r):a=>[...a,r])},Y=()=>{if(g.length===0)return;const r="06:00",o="23:00";if(h.horaInicio<r||h.horaInicio>o){u({open:!0,message:"La hora de inicio debe ser entre 06:00 y 23:00",severity:"warning"});return}if(h.horaFin<r||h.horaFin>o){u({open:!0,message:"La hora de fin debe ser entre 06:00 y 23:00",severity:"warning"});return}const a=(h.horaInicio||"").split(":")[1],c=(h.horaFin||"").split(":")[1];if(a!=="00"||c!=="00"){u({open:!0,message:"Solo se permiten horas en punto (minutos 00)",severity:"warning"});return}const s=g.map(n=>({dia:n,horaInicio:h.horaInicio,horaFin:h.horaFin}));f(n=>({...n,horariosPorDia:[...n.horariosPorDia,...s]})),v([]),u({open:!0,message:s.length>1?"Horarios agregados":"Horario agregado",severity:"success"})},q=(r,o,a)=>{const c=[...i.horariosPorDia];c[r]={...c[r],[o]:a},f(s=>({...s,horariosPorDia:c})),l[`horario_${r}_${o}`]&&j(s=>({...s,[`horario_${r}_${o}`]:""}))},Z=r=>{f(o=>({...o,horariosPorDia:o.horariosPorDia.filter((a,c)=>c!==r)})),u({open:!0,message:"Horario eliminado",severity:"success"})},ee=()=>{const r={};if(i.profesorId||(r.profesorId="Debe seleccionar un profesor"),i.horariosPorDia.length===0)r.horariosPorDia="Debe configurar al menos un horario por día";else{const o=new Set,a="06:00",c="23:00";i.horariosPorDia.forEach((s,n)=>{if(s.dia?o.has(s.dia)?r[`horario_${n}_dia`]="Este día ya está configurado":o.add(s.dia):r[`horario_${n}_dia`]="Debe seleccionar un día",s.horaInicio||(r[`horario_${n}_horaInicio`]="Debe especificar hora de inicio"),s.horaFin||(r[`horario_${n}_horaFin`]="Debe especificar hora de fin"),s.horaInicio&&s.horaFin){const[ie,B]=s.horaInicio.split(":").map(Number),[se,E]=s.horaFin.split(":").map(Number),ne=ie*60+B;se*60+E<=ne&&(r[`horario_${n}_horaFin`]="La hora de fin debe ser posterior a la hora de inicio"),s.horaInicio<a&&(r[`horario_${n}_horaInicio`]="La hora de inicio no puede ser antes de 06:00"),s.horaFin>c&&(r[`horario_${n}_horaFin`]="La hora de fin no puede ser después de 23:00"),String(B).padStart(2,"0")!=="00"&&(r[`horario_${n}_horaInicio`]="La hora de inicio debe ser en punto (minutos 00)"),String(E).padStart(2,"0")!=="00"&&(r[`horario_${n}_horaFin`]="La hora de fin debe ser en punto (minutos 00)")}})}return i.estado==="cancelado"&&!i.motivo.trim()&&(r.motivo="Debe especificar un motivo para la cancelación"),j(r),Object.keys(r).length===0},re=()=>{ee()&&(K({profesorId:i.profesorId,horariosPorDia:i.horariosPorDia,estado:i.estado,motivo:i.estado==="cancelado"?i.motivo:""}),_())},oe=()=>{f({profesorId:"",estado:"activo",motivo:"",horariosPorDia:[]}),j({}),v([]),y({horaInicio:"09:00",horaFin:"17:00"}),_()},ae=i.profesorId&&i.horariosPorDia.length>0&&i.horariosPorDia.every(r=>r.dia&&r.horaInicio&&r.horaFin);return e.jsxs(te,{open:F,onClose:oe,fullWidth:!0,maxWidth:"md",disableEscapeKeyDown:!0,closeAfterTransition:!0,slotProps:{backdrop:{onClick:()=>{}}},sx:{"& .MuiDialog-paper":{marginTop:"4rem",marginBottom:"2rem"}},PaperProps:{sx:{borderRadius:"12px",boxShadow:"0 4px 30px rgba(0,0,0,0.2)",overflow:"hidden"}},children:[e.jsxs(le,{sx:{bgcolor:"#0455a2",color:"white",fontWeight:600,display:"flex",justifyContent:"space-between",alignItems:"center",p:2},children:[e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(me,{}),p?"Editar Programación":"Agregar Programación"]}),e.jsx(N,{onClick:_,sx:{color:"white"},children:e.jsx(ce,{})})]}),e.jsx(de,{sx:{p:3,mt:3},children:e.jsxs(t,{container:!0,spacing:3,children:[e.jsx(t,{item:!0,xs:12,children:e.jsxs(D,{fullWidth:!0,error:!!l.profesorId,children:[e.jsx(C,{children:"Profesor"}),e.jsxs(S,{value:i.profesorId,onChange:r=>T("profesorId",r.target.value),label:"Profesor",required:!0,disabled:p,children:[e.jsx(b,{value:"",children:e.jsx("em",{children:"Seleccionar Profesor"})}),U.map(r=>e.jsx(b,{value:r.id,children:e.jsxs(x,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(x,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:r.color||"#ccc"}}),e.jsx(d,{sx:{fontWeight:500},children:r.nombre}),Array.isArray(r.especialidades)&&r.especialidades.length>0&&e.jsx(W,{label:r.especialidades.join(", "),size:"small",sx:{ml:1,bgcolor:"rgba(4,85,162,0.08)",color:"#0455a2","& .MuiChip-label":{px:1}}})]})},r.id))]}),l.profesorId&&e.jsx(d,{variant:"caption",color:"error",sx:{mt:.5},children:l.profesorId}),p&&e.jsx(d,{variant:"caption",color:"text.secondary",sx:{mt:.5},children:"No se puede cambiar el profesor en una programación existente"})]})}),p&&e.jsx(t,{item:!0,xs:12,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(C,{children:"Estado"}),e.jsxs(S,{value:i.estado,onChange:r=>T("estado",r.target.value),label:"Estado",children:[e.jsx(b,{value:"activo",children:"Activo"}),e.jsx(b,{value:"cancelado",children:"Cancelado"})]})]})}),p&&i.estado==="cancelado"&&e.jsx(t,{item:!0,xs:12,children:e.jsx(A,{fullWidth:!0,label:"Motivo de cancelación",value:i.motivo,onChange:r=>T("motivo",r.target.value),multiline:!0,rows:2,error:!!l.motivo,helperText:l.motivo,required:!0})}),e.jsx(t,{item:!0,xs:12,children:e.jsx(he,{sx:{my:2},children:e.jsx(d,{variant:"body2",color:"text.secondary",children:"Configuración de Horarios"})})}),e.jsxs(t,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#0455a2"},children:"Seleccionar Días"}),e.jsxs(P,{sx:{p:2,bgcolor:"#f8f9fa",borderRadius:2,border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",minHeight:"200px"},children:[e.jsx(d,{variant:"body2",sx:{mb:2,color:"text.secondary"},children:"Haga clic en los días que desea agregar:"}),e.jsx(x,{sx:{display:"flex",flexWrap:"wrap",gap:1,mb:2},children:O.map(r=>{const o=g.includes(r),a=i.horariosPorDia.some(c=>c.dia===r);return e.jsx(W,{label:w[r],onClick:()=>{a||Q(r)},color:o?"primary":"default",variant:o?"filled":"outlined",disabled:a,sx:{cursor:a?"not-allowed":"pointer",opacity:a?.5:1,"&:hover":{backgroundColor:o?void 0:"rgba(4, 85, 162, 0.08)"}}},r)})}),g.length>0&&e.jsxs(x,{sx:{mb:2},children:[e.jsxs(d,{variant:"body2",sx:{mb:1,fontWeight:500},children:["Días seleccionados: ",g.map(r=>w[r]).join(", ")]}),e.jsx(V,{startIcon:e.jsx(fe,{}),onClick:Y,variant:"contained",size:"small",sx:{textTransform:"none"},children:"Agregar con horario por defecto"})]})]})]}),e.jsxs(t,{item:!0,xs:12,md:6,children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#0455a2"},children:"Horario por Defecto"}),e.jsxs(P,{sx:{p:2,bgcolor:"#f8f9fa",borderRadius:2,border:"1px solid #e0e0e0",boxShadow:"0 2px 8px rgba(0,0,0,0.1)",minHeight:"200px"},children:[e.jsx(d,{variant:"body2",sx:{mb:2,color:"text.secondary"},children:"Configure el horario que se aplicará a los días seleccionados:"}),e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:6,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(C,{children:"Hora de Inicio"}),e.jsx(S,{label:"Hora de Inicio",value:(h.horaInicio||"").split(":")[0]||"",onChange:r=>y(o=>({...o,horaInicio:`${r.target.value}:00`})),children:R.map(r=>e.jsx(b,{value:r,children:`${r}:00`},`inicio-${r}`))})]})}),e.jsx(t,{item:!0,xs:6,children:e.jsxs(D,{fullWidth:!0,children:[e.jsx(C,{children:"Hora de Fin"}),e.jsx(S,{label:"Hora de Fin",value:(h.horaFin||"").split(":")[0]||"",onChange:r=>y(o=>({...o,horaFin:`${r.target.value}:00`})),children:R.map(r=>e.jsx(b,{value:r,children:`${r}:00`},`fin-${r}`))})]})})]})]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(d,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#0455a2"},children:"Horarios Configurados"}),l.horariosPorDia&&e.jsx(G,{severity:"error",sx:{mb:2},children:l.horariosPorDia}),i.horariosPorDia.length===0?e.jsx(P,{sx:{p:3,textAlign:"center",bgcolor:"#f8f9fa"},children:e.jsx(d,{color:"text.secondary",children:"No hay horarios configurados. Seleccione días arriba para comenzar."})}):e.jsx(x,{sx:{display:"flex",flexDirection:"column",gap:2},children:i.horariosPorDia.map((r,o)=>e.jsxs(P,{sx:{p:2,border:"1px solid #e0e0e0",borderRadius:2,bgcolor:"#ffffff",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs(x,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsx(x,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(W,{label:w[r.dia],size:"small",color:"primary",sx:{fontWeight:500,minWidth:"80px"}})}),e.jsx(N,{onClick:()=>Z(o),size:"small",color:"error",children:e.jsx(ge,{})})]}),e.jsxs(t,{container:!0,spacing:2,children:[e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(A,{label:"Hora de Inicio",type:"time",value:r.horaInicio,onChange:a=>q(o,"horaInicio",a.target.value),fullWidth:!0,required:!0,error:!!l[`horario_${o}_horaInicio`],helperText:l[`horario_${o}_horaInicio`],inputProps:{min:"06:00",max:"23:00",step:3600},InputProps:{startAdornment:e.jsx(J,{position:"start",children:e.jsx(X,{fontSize:"small"})})}})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(A,{label:"Hora de Fin",type:"time",value:r.horaFin,onChange:a=>q(o,"horaFin",a.target.value),fullWidth:!0,required:!0,error:!!l[`horario_${o}_horaFin`],helperText:l[`horario_${o}_horaFin`],inputProps:{min:"06:00",max:"23:00",step:3600},InputProps:{startAdornment:e.jsx(J,{position:"start",children:e.jsx(X,{fontSize:"small"})})}})})]})]},o))})]})]})}),e.jsx(xe,{sx:{p:2,bgcolor:"#f9f9f9",justifyContent:"flex-end",gap:1},children:e.jsxs(x,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(V,{onClick:async()=>{if(!$){z(!0);try{await re()}finally{z(!1)}}},variant:"contained",disableElevation:!0,disabled:!ae||$,sx:{backgroundColor:"#0455a2",borderRadius:"8px",textTransform:"none",fontWeight:500,px:3,"&:hover":{backgroundColor:"#033b70"}},children:p?"Guardar Cambios":"Agregar Programación"}),$&&e.jsx(pe,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})}),e.jsx(ue,{open:I.open,autoHideDuration:4e3,onClose:()=>u({...I,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(G,{onClose:()=>u({...I,open:!1}),severity:I.severity,variant:"filled",sx:{width:"100%",borderRadius:"8px"},children:I.message})})]})};export{Se as S};
