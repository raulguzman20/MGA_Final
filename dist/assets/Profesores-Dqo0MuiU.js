const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jspdf.es.min-Cx3ujUWE.js","assets/index-D2WH0i0l.js","assets/typeof-QjJsDpFa.js"])))=>i.map(i=>d[i]);
import{r as c,j as a,B as y,I as V,a4 as Ce,T as Y,a5 as Ee,G as R,E as v,a6 as Se,y as H,b as we}from"./index-D2WH0i0l.js";import{G as ve}from"./GenericList-CZICF8vs.js";import{D as Ae}from"./DetailModal-BVuqfkLW.js";import{F as je}from"./FormModal-BqkXggEq.js";import{S as W}from"./StatusButton-T52DgIHd.js";import{S as Pe}from"./SuccessAlert-D_Anh4KD.js";import{C as Me}from"./ConfirmationDialog-BkQTGDdL.js";import{S as Le}from"./ScheduleModal-BhgwXoI-.js";import"./Search-CIHESQ8V.js";import"./NavigateNext-C2-Nd8B6.js";import"./TableRow-CTBWTERd.js";import"./Stack-BupWGgAE.js";import"./Checkbox-4ec6YfyB.js";import"./Switch-qiKByfkr.js";import"./FormControlLabel-CLvj0mWI.js";import"./EventNote-C1bQThfN.js";import"./CalendarMonth-D4CxqV-i.js";import"./Add-BsbvM-9j.js";import"./InputAdornment-RiOQfDiX.js";import"./AccessTime-BdvwmUhM.js";const $e=["Do","Lu","Ma","Mi","Ju","Vi","Sa"],Fe=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],Te=({date:w,onDateChange:A,programaciones:h=[]})=>{const[f,n]=c.useState(w.getMonth()),[u,$]=c.useState(w.getFullYear()),F=(p,x)=>new Date(x,p+1,0).getDate(),_=(p,x)=>new Date(x,p,1).getDay(),j=()=>{f===0?(n(11),$(u-1)):n(f-1)},z=()=>{f===11?(n(0),$(u+1)):n(f+1)},P=()=>{const p=F(f,u),x=_(f,u),g=[];for(let d=0;d<x;d++)g.push(a.jsx(y,{sx:{height:36,width:36}},`empty-${d}`));for(let d=1;d<=p;d++){const I=h.some(M=>{const C=new Date(M.fecha);return C.getDate()===d&&C.getMonth()===f&&C.getFullYear()===u});g.push(a.jsx(y,{sx:{height:36,width:36,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",cursor:"pointer",backgroundColor:I?"primary.light":"transparent","&:hover":{backgroundColor:"action.hover"}},onClick:()=>{A(new Date(u,f,d))},children:d},`day-${d}`))}return g};return a.jsxs(y,{sx:{width:"100%",p:2,border:"1px solid",borderColor:"divider",borderRadius:1},children:[a.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsx(V,{onClick:j,size:"small",children:a.jsx(Ce,{})}),a.jsxs(Y,{variant:"h6",children:[Fe[f]," ",u]}),a.jsx(V,{onClick:z,size:"small",children:a.jsx(Ee,{})})]}),a.jsx(R,{container:!0,spacing:1,children:$e.map(p=>a.jsx(R,{item:!0,xs:12/7,children:a.jsx(Y,{variant:"caption",align:"center",sx:{display:"block",fontWeight:"bold"},children:p})},p))}),a.jsx(R,{container:!0,spacing:1,sx:{mt:1},children:P().map((p,x)=>a.jsx(R,{item:!0,xs:12/7,sx:{display:"flex",justifyContent:"center"},children:p},x))})]})},Xe=()=>{const[w,A]=c.useState([]),[h,f]=c.useState([]),[n,u]=c.useState(null),[$,F]=c.useState(!1),[_,j]=c.useState(!1),[z,P]=c.useState(!1),[p,x]=c.useState(!1),[g,d]=c.useState([]),[I,M]=c.useState({}),[C,l]=c.useState({open:!1,message:""}),[J,O]=c.useState(!1),[b,N]=c.useState(null),[T,U]=c.useState(""),[K,k]=c.useState([]),Q=[{id:"nombres",label:"Nombres"},{id:"apellidos",label:"Apellidos"},{id:"tipoDocumento",label:"Tipo de Documento"},{id:"identificacion",label:"Número de Identificación"},{id:"telefono",label:"Teléfono"},{id:"correo",label:"Correo"},{id:"estado",label:"Estado",render:(e,o)=>a.jsx(W,{active:e==="Activo",onClick:()=>ne(o._id)},`status-${o._id}`)}],X=[{id:"nombres",label:"Nombres"},{id:"apellidos",label:"Apellidos"},{id:"tipoDocumento",label:"Tipo de Documento"},{id:"identificacion",label:"Número de Identificación"},{id:"telefono",label:"Teléfono"},{id:"direccion",label:"Dirección"},{id:"correo",label:"Correo Electrónico"},{id:"especialidades",label:"Especialidades",render:e=>a.jsx(y,{children:e&&Array.isArray(e)&&e.length>0?e.map((o,t)=>a.jsx(H,{label:o?o.toString():"Sin nombre",sx:{m:.5},size:"small",color:"primary",variant:"outlined"},`detail-especialidad-${t}`)):a.jsx("span",{children:"No hay especialidades asignadas"})})},{id:"estado",label:"Estado",render:e=>a.jsx(W,{active:e==="Activo"})}],ee=async()=>{var e;try{console.log("Fetching especialidades from cursos...");const o=await v.get("http://localhost:3000/api/cursos");if(console.log("Cursos fetched:",o.data),!Array.isArray(o.data)){console.error("Response data is not an array:",o.data),A([]);return}const t=[...new Set(o.data.filter(s=>s&&s.estado===!0&&s.nombre).map(s=>s.nombre.toString()))].sort();console.log("Especialidades únicas:",t),A(t)}catch(o){console.error("Error fetching especialidades:",o),console.error("Fetch error response:",(e=o.response)==null?void 0:e.data),A([]),l({open:!0,message:"Error al cargar las especialidades"})}},q=async()=>{var e;try{console.log("Fetching professors...");const o=await v.get("http://localhost:3000/api/profesores");console.log("Professors fetched:",o.data),console.log("Number of professors:",o.data.length),f(o.data),console.log("Professors state updated")}catch(o){console.error("Error fetching professors:",o),console.error("Fetch error response:",(e=o.response)==null?void 0:e.data),l({open:!0,message:"Error al cargar los profesores"})}};c.useEffect(()=>{q(),ee()},[]),c.useEffect(()=>{console.log("Professors state changed:",h.length,"professors")},[h]),c.useEffect(()=>{if(!T.trim())k(h);else{const e=h.filter(o=>{var s,i,r,m,E;const t=T.toLowerCase();return((s=o.nombres)==null?void 0:s.toLowerCase().includes(t))||((i=o.apellidos)==null?void 0:i.toLowerCase().includes(t))||((r=o.identificacion)==null?void 0:r.toLowerCase().includes(t))||((m=o.correo)==null?void 0:m.toLowerCase().includes(t))||((E=o.telefono)==null?void 0:E.toLowerCase().includes(t))});k(e)}},[h,T]);const oe=()=>{x(!1),u(null),d([]),M({}),j(!0)},se=e=>{x(!0);const o={...e,especialidades:Array.isArray(e.especialidades)?e.especialidades:e.especialidades?[e.especialidades]:[],estado:e.estado==="Activo"};u(o),d(e.programacion||[]),j(!0)},te=e=>{u(e),F(!0)},re=e=>{N(e),O(!0)},ae=async()=>{var e,o,t,s,i;if(b)try{await v.delete(`http://localhost:3000/api/profesores/${b._id}`),await q(),l({open:!0,message:"Profesor eliminado correctamente"})}catch(r){if(console.error("Error deleting professor:",r),((e=r.response)==null?void 0:e.status)===400)l({open:!0,message:r.response.data.message||"No se puede eliminar el profesor porque está asociado a programaciones de clases"});else{const m=((t=(o=r.response)==null?void 0:o.data)==null?void 0:t.message)||((i=(s=r.response)==null?void 0:s.data)==null?void 0:i.details)||"Error al eliminar el profesor";l({open:!0,message:m})}}finally{O(!1),N(null)}},ie=async e=>{var o,t;try{console.log("=== DEBUG HANDLESUBMIT ==="),console.log("isEditing:",p),console.log("formData:",e),console.log("tempProgramacion:",g),console.log("========================");const i=["nombres","apellidos","tipoDocumento","identificacion","telefono","correo","especialidades"].filter(S=>S==="especialidades"?!e[S]||Array.isArray(e[S])&&e[S].length===0:!e[S]||e[S].toString().trim()==="");if(i.length>0){l({open:!0,message:`Los campos ${i.join(", ")} son obligatorios`});return}const r=/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s.\'-]+$/;if(!r.test(e.nombres)){l({open:!0,message:"El nombre solo permite letras, espacios, puntos, apóstrofes y guiones"});return}if(!r.test(e.apellidos)){l({open:!0,message:"El apellido solo permite letras, espacios, puntos, apóstrofes y guiones"});return}if(!/^[0-9A-Za-z\-]+$/.test(e.identificacion)){l({open:!0,message:"La identificación solo permite números, letras y guiones"});return}if(!/^[0-9+\-\s().ext]+$/.test(e.telefono)){l({open:!0,message:"El teléfono solo permite números, espacios, guiones y extensiones"});return}if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e.correo)){l({open:!0,message:"El formato del correo electrónico no es válido"});return}const Z=fe(e.correo);if(Z){l({open:!0,message:Z});return}if(!Array.isArray(e.especialidades)||e.especialidades.length===0){l({open:!0,message:"Debe seleccionar al menos una especialidad"});return}const L={nombres:e.nombres.trim(),apellidos:e.apellidos.trim(),tipoDocumento:e.tipoDocumento,identificacion:e.identificacion.toString().trim(),telefono:e.telefono.trim(),correo:e.correo.trim().toLowerCase(),estado:e.estado?"Activo":"Inactivo",especialidades:Array.isArray(e.especialidades)?e.especialidades:[e.especialidades]};e.password&&e.password.trim()&&(L.contrasena=e.password.trim()),e.direccion&&e.direccion.trim()&&(L.direccion=e.direccion.trim()),(g==null?void 0:g.length)>0&&(L.programacion=g);const G={headers:{"Content-Type":"application/json"},timeout:3e4};if(p)await v.put(`http://localhost:3000/api/profesores/${n._id}`,L,G),l({open:!0,message:"Profesor actualizado correctamente"});else{const S=await v.post("http://localhost:3000/api/profesores",L,G);l({open:!0,message:"Profesor creado correctamente"})}console.log("Recargando lista de profesores..."),await q(),console.log("Lista de profesores actualizada"),setTimeout(()=>{B()},100)}catch(s){console.error("Error saving professor:",s),console.error("Error response:",(o=s.response)==null?void 0:o.data);let i="Error al guardar el profesor";if((t=s.response)!=null&&t.data){const r=s.response.data;r.details?i=r.details:r.message?i=r.message:r.error?i=r.error:typeof r=="string"&&(i=r)}else s.message&&(i=s.message);l({open:!0,message:i})}},ne=async e=>{var o,t,s,i;try{const r=h.find(E=>E._id===e);if(!r)return;const m=r.estado==="Activo"?"Inactivo":"Activo";await v.patch(`http://localhost:3000/api/profesores/${e}/estado`,{estado:m}),f(E=>E.map(D=>D._id===e?{...D,estado:m}:D)),l({open:!0,message:"Estado actualizado correctamente"})}catch(r){console.error("Error updating professor status:",r);const m=((t=(o=r.response)==null?void 0:o.data)==null?void 0:t.message)||((i=(s=r.response)==null?void 0:s.data)==null?void 0:i.details)||"Error al actualizar el estado";l({open:!0,message:m})}},le=()=>{F(!1),u(null)},B=()=>{j(!1),u(null),x(!1),d([]),M({})},ce=e=>{M(e),P(!0)},de=()=>{P(!1)},pe=e=>{d(o=>[...o,e]),P(!1)},ue=()=>{l({...C,open:!1})},me=e=>{U(e.target.value)},fe=e=>{if(!e||!e.trim())return null;const o=h.find(t=>{var s;return((s=t.correo)==null?void 0:s.toLowerCase())===e.toLowerCase()&&t._id!==(n==null?void 0:n._id)});return o?`El correo ${e} ya está siendo usado por ${o.nombres} ${o.apellidos}`:null},ge=e=>e?e.length<7?"El teléfono debe tener al menos 7 caracteres":e.length>10?"El teléfono no puede exceder 10 caracteres":/^[0-9+\-\s().ext]+$/.test(e)?null:"El teléfono solo permite números, espacios, guiones y extensiones":"El teléfono es requerido",he=e=>e?e.length>20?"La contraseña no puede exceder 20 caracteres":null:"La contraseña es requerida",xe=(e,o)=>e?e!==o?"Las contraseñas no coinciden":null:"Debe confirmar la contraseña",be=()=>{Se(async()=>{const{jsPDF:e}=await import("./jspdf.es.min-Cx3ujUWE.js");return{jsPDF:e}},__vite__mapDeps([0,1,2])).then(({jsPDF:e})=>{const o=new e;o.text("Lista de Profesores",10,10),o.setFontSize(12),o.text("Nombres",10,20),o.text("Apellidos",50,20),o.text("N° ID",90,20),o.text("Teléfono",130,20),o.text("Especialidad",170,20);let t=30;h.forEach(s=>{o.text(s.nombres||"",10,t),o.text(s.apellidos||"",50,t),o.text(s.identificacion||"",90,t),o.text(s.telefono||"",130,t);const i=Array.isArray(s.especialidades)?s.especialidades.join(", "):s.especialidades||"";o.text(i,170,t),t+=10}),o.save("profesores.pdf")}).catch(e=>{console.error("Error generating PDF:",e)})},ye=()=>{const e=[{id:"rol",label:"Rol Profesor",type:"text",defaultValue:"Profesor",disabled:!0},{id:"nombres",label:"Nombres",type:"text",required:!0},{id:"apellidos",label:"Apellidos",type:"text",required:!0},{id:"tipoDocumento",label:"Tipo de documento *",type:"select",required:!0,options:[{value:"CC",label:"Cédula de Ciudadanía"},{value:"CE",label:"Cédula de Extranjería"},{value:"TI",label:"Tarjeta de Identidad"},{value:"PA",label:"Pasaporte"},{value:"RC",label:"Registro Civil"}]},{id:"identificacion",label:"Número de Identificación *",type:"text",required:!0,maxLength:10,helperText:"Máximo 10 caracteres"},{id:"telefono",label:"Teléfono *",type:"text",required:!0,maxLength:10,helperText:"Mínimo 7, máximo 10 caracteres",validateOnChange:!0,validate:o=>ge(o)},{id:"direccion",label:"Dirección",type:"text",required:!1},{id:"correo",label:"Correo Electrónico *",type:"email",required:!0,validateOnChange:!0,validate:o=>{if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(o))return"El formato del correo electrónico no es válido";const s=h.find(i=>{var r;return((r=i.correo)==null?void 0:r.toLowerCase())===o.toLowerCase()&&i._id!==(n==null?void 0:n._id)});return s?`El correo ${o} ya está siendo usado por ${s.nombres} ${s.apellidos}`:null}},{id:"especialidades",label:"Especialidades *",type:"multiSelect",options:w&&w.length>0?w.map(o=>({value:o,label:o})):[],required:!0,helperText:"Seleccione una o más especialidades"},{id:"estado",label:"Estado",type:"switch",defaultValue:!0,helperText:"Activo permite al profesor iniciar sesión"}];return e.push({id:"programacion",label:"Programación de Horarios",type:"custom",render:(o,t,s)=>a.jsxs(y,{sx:{mt:1},children:[a.jsx(y,{sx:{mb:2},children:a.jsx(Te,{programacion:g})}),a.jsx(y,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:2},children:g.map((i,r)=>a.jsx(H,{size:"small",label:`${i.dia}: ${i.horaInicio} - ${i.horaFin}`,onDelete:()=>{const m=[...g];m.splice(r,1),d(m)},color:"primary",variant:"outlined"},`form-schedule-${r}`))}),a.jsx(we,{variant:"outlined",fullWidth:!0,onClick:()=>ce(s),color:"primary",children:"Agregar Horario"})]})}),p||e.push({id:"password",label:"Contraseña *",type:"password",required:!0,maxLength:20,helperText:"Máximo 20 caracteres",validateOnChange:!0,validate:(o,t)=>he(o)},{id:"confirmPassword",label:"Confirmar Contraseña *",type:"password",required:!0,maxLength:20,helperText:"Debe coincidir con la contraseña",validateOnChange:!0,validate:(o,t)=>xe(o,t.password)}),e};return a.jsxs(a.Fragment,{children:[a.jsx(ve,{data:K,columns:Q,onEdit:se,onDelete:re,onCreate:oe,onView:te,onExportPdf:be,title:"Gestión de Profesores",searchTerm:T,onSearch:me,showSearch:!0}),a.jsx(Ae,{title:`Detalle del Profesor ${n==null?void 0:n.nombres} ${n==null?void 0:n.apellidos}`,data:n,fields:X,open:$,onClose:le}),a.jsx(je,{title:p?"Editar Profesor":"Crear Nuevo Profesor",fields:ye(),initialData:n,open:_,onClose:B,onSubmit:ie,disableBackdropClick:!0,disableEscapeKeyDown:!0,maxWidth:"md",fullWidth:!0,contentProps:{sx:{maxHeight:"80vh",overflowY:"auto"}}}),a.jsx(Le,{open:z,onClose:de,onSubmit:pe}),a.jsx(Me,{open:J,title:"Confirmar Eliminación",content:`¿Está seguro que desea eliminar al profesor ${b==null?void 0:b.nombres} ${b==null?void 0:b.apellidos}? 

  Esta acción no se puede deshacer. Si el profesor está asociado a programaciones de clases, no se podrá eliminar.`,onConfirm:ae,onClose:()=>O(!1),confirmButtonColor:"#f44336",confirmButtonText:"Eliminar"}),a.jsx(Pe,{open:C.open,message:C.message,onClose:ue})]})};export{Xe as default};
