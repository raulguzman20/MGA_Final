import{aD as qo,Q as Uo,aE as Go,m as ao,ax as Jo,aF as Xo,aC as Qo,ay as Yo,aG as Ko,aw as Zo,aH as ea,aI as oa,aB as aa,O as ra,N as sa,g as ia,f as ta,r as h,h as na,_ as la,i as eo,j as e,s as ca,k as da,l as pa,aJ as go,aK as Mo,aL as ha,aM as fa,o as Bo,ab as Wo,aN as xa,a0 as Pe,a7 as Me,aO as to,I as se,a1 as Lo,a2 as Be,G as T,B as p,F as no,q as lo,S as co,M as Ye,D as je,y as ee,P as We,C as xo,T as c,R as ma,X as bo,Y as jo,a8 as Le,au as ua,c as Fe,t as Oo,v as Fo,ae as Ho,x as To,a9 as Oe,b as Q,E as W,p as ga,a3 as ba,A as ja,aP as yo}from"./index-D2WH0i0l.js";import{h as Vo}from"./es-DeJEf6oD.js";import{A as ya}from"./Autocomplete-CRX_95Jf.js";import{a as x}from"./colorManipulator-BH8nPo7d.js";import{C as Ca}from"./ConfirmationDialog-BkQTGDdL.js";import{I as va}from"./InputAdornment-RiOQfDiX.js";import{S as Sa,C as Ia,a as Ke,F as wa,E as Co,D as vo}from"./Search-CIHESQ8V.js";import{A as So}from"./Add-BsbvM-9j.js";import{T as po}from"./AccessTime-BdvwmUhM.js";import{A as Ae,G as ho,B as Io}from"./Group-B57wGzNo.js";import{C as ka}from"./Checkbox-4ec6YfyB.js";import"./usePreviousProps-C0i_9UfY.js";function Da(s,C){return()=>null}function _a(s,C){return()=>null}function za(s,C,t,g,j){return null}function $a(s){return String(s).match(/[\d.\-+]*\s*(.*)/)[1]||""}function Ra(s){return parseFloat(s)}const Ea={configure:s=>{qo.configure(s)}},Aa=Object.freeze(Object.defineProperty({__proto__:null,capitalize:Uo,createChainedFunction:Go,createSvgIcon:ao,debounce:Jo,deprecatedPropType:Da,isMuiElement:Xo,ownerDocument:Qo,ownerWindow:Yo,requirePropFactory:_a,setRef:Ko,unstable_ClassNameGenerator:Ea,unstable_useEnhancedEffect:Zo,unstable_useId:ea,unsupportedProp:za,useControlled:oa,useEventCallback:aa,useForkRef:ra,useIsFocusVisible:sa},Symbol.toStringTag,{value:"Module"}));function Pa(s){return ia("MuiSkeleton",s)}ta("MuiSkeleton",["root","text","rectangular","rounded","circular","pulse","wave","withChildren","fitContent","heightAuto"]);const Ma=["animation","className","component","height","style","variant","width"];let oo=s=>s,wo,ko,Do,_o;const Ba=s=>{const{classes:C,variant:t,animation:g,hasChildren:j,width:oe,height:O}=s;return pa({root:["root",t,g,j&&"withChildren",j&&!oe&&"fitContent",j&&!O&&"heightAuto"]},Pa,C)},Wa=Mo(wo||(wo=oo`
  0% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }

  100% {
    opacity: 1;
  }
`)),La=Mo(ko||(ko=oo`
  0% {
    transform: translateX(-100%);
  }

  50% {
    /* +0.5s of delay between each loop */
    transform: translateX(100%);
  }

  100% {
    transform: translateX(100%);
  }
`)),Oa=ca("span",{name:"MuiSkeleton",slot:"Root",overridesResolver:(s,C)=>{const{ownerState:t}=s;return[C.root,C[t.variant],t.animation!==!1&&C[t.animation],t.hasChildren&&C.withChildren,t.hasChildren&&!t.width&&C.fitContent,t.hasChildren&&!t.height&&C.heightAuto]}})(({theme:s,ownerState:C})=>{const t=$a(s.shape.borderRadius)||"px",g=Ra(s.shape.borderRadius);return eo({display:"block",backgroundColor:s.vars?s.vars.palette.Skeleton.bg:x(s.palette.text.primary,s.palette.mode==="light"?.11:.13),height:"1.2em"},C.variant==="text"&&{marginTop:0,marginBottom:0,height:"auto",transformOrigin:"0 55%",transform:"scale(1, 0.60)",borderRadius:`${g}${t}/${Math.round(g/.6*10)/10}${t}`,"&:empty:before":{content:'"\\00a0"'}},C.variant==="circular"&&{borderRadius:"50%"},C.variant==="rounded"&&{borderRadius:(s.vars||s).shape.borderRadius},C.hasChildren&&{"& > *":{visibility:"hidden"}},C.hasChildren&&!C.width&&{maxWidth:"fit-content"},C.hasChildren&&!C.height&&{height:"auto"})},({ownerState:s})=>s.animation==="pulse"&&go(Do||(Do=oo`
      animation: ${0} 2s ease-in-out 0.5s infinite;
    `),Wa),({ownerState:s,theme:C})=>s.animation==="wave"&&go(_o||(_o=oo`
      position: relative;
      overflow: hidden;

      /* Fix bug in Safari https://bugs.webkit.org/show_bug.cgi?id=68196 */
      -webkit-mask-image: -webkit-radial-gradient(white, black);

      &::after {
        animation: ${0} 2s linear 0.5s infinite;
        background: linear-gradient(
          90deg,
          transparent,
          ${0},
          transparent
        );
        content: '';
        position: absolute;
        transform: translateX(-100%); /* Avoid flash during server-side hydration */
        bottom: 0;
        left: 0;
        right: 0;
        top: 0;
      }
    `),La,(C.vars||C).palette.action.hover)),Fa=h.forwardRef(function(C,t){const g=na({props:C,name:"MuiSkeleton"}),{animation:j="pulse",className:oe,component:O="span",height:de,style:B,variant:ie="text",width:E}=g,q=la(g,Ma),Y=eo({},g,{animation:j,component:O,variant:ie,hasChildren:!!q.children}),pe=Ba(Y);return e.jsx(Oa,eo({as:O,ref:t,className:da(pe.root,oe),ownerState:Y},q,{style:eo({width:E,height:de},B)}))}),zo=ao(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info"),Ha=ao(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"RadioButtonUnchecked"),Ta=ao(e.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");var fo={};const Va=ha(Aa);var $o;function Na(){return $o||($o=1,function(s){"use client";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return C.createSvgIcon}});var C=Va}(fo)),fo}var mo={},qa=fa;Object.defineProperty(mo,"__esModule",{value:!0});var No=mo.default=void 0,Ua=qa(Na()),Ga=e;No=mo.default=(0,Ua.default)((0,Ga.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");const Ro=["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado","Domingo"],Ze={Lunes:"L",Martes:"M",MiÃ©rcoles:"X",Jueves:"J",Viernes:"V",SÃ¡bado:"S",Domingo:"D"},Eo={L:"Lunes",M:"Martes",X:"MiÃ©rcoles",J:"Jueves",V:"Viernes",S:"SÃ¡bado",D:"Domingo"},Ao=({isOpen:s,onClose:C,onSubmit:t,editMode:g=!1,claseAEditar:j=null,aulas:oe=null})=>{var Se,qe,Ue,Ge,Je,Xe,Qe,Ie,we;const[O,de]=h.useState([]),[B,ie]=h.useState(""),[E,q]=h.useState(null),[Y,pe]=h.useState([]),[S,le]=h.useState(null),[he,ke]=h.useState([]),[U,G]=h.useState([]),[V,K]=h.useState(""),[L,fe]=h.useState(""),[te,De]=h.useState(!1),[xe,_e]=h.useState([]),[ae,He]=h.useState([]),[J,f]=h.useState(""),[ne,ze]=h.useState(!1),n=Bo(),{darkMode:k}=h.useContext(Wo);xa(n.breakpoints.down("md"));const ye={"&::-webkit-scrollbar":{width:"8px",height:"8px"},"&::-webkit-scrollbar-track":{background:k?x(n.palette.background.paper,.15):n.palette.grey[100],borderRadius:"4px"},"&::-webkit-scrollbar-thumb":{background:n.palette.primary.main,borderRadius:"4px","&:hover":{background:n.palette.primary.dark}},scrollbarWidth:"thin",scrollbarColor:`${n.palette.primary.main} ${k?x(n.palette.background.paper,.15):n.palette.grey[100]}`};h.useEffect(()=>{oe?He(oe):s&&(async()=>{try{const r=await W.get("http://localhost:3000/api/aulas");He(r.data.filter(l=>l.estado==="Activo"||l.estado==="Disponible"))}catch(r){console.error("Error al cargar aulas:",r)}})()},[s,oe]),h.useEffect(()=>{s&&(async()=>{try{const l=(await W.get("http://localhost:3000/api/programacion_de_profesores")).data.filter(i=>i.estado==="activo"&&i.horariosPorDia&&i.horariosPorDia.length>0).map(i=>{var I,P,v,b;return{id:((I=i.profesor)==null?void 0:I._id)||i.profesor,nombre:(P=i.profesor)!=null&&P.nombres?`${i.profesor.nombres} ${i.profesor.apellidos}`:typeof i.profesor=="string"?i.profesor:"Profesor sin nombre",especialidades:((v=i.profesor)==null?void 0:v.especialidades)||[],color:((b=i.profesor)==null?void 0:b.color)||"#0455a2",programacionId:i._id,horariosPorDia:i.horariosPorDia||[]}});console.log("âœ… Profesores con horarios por dÃ­a cargados:",l),de(l)}catch(r){console.error("âŒ Error al cargar profesores:",r)}})()},[s]),h.useEffect(()=>{s&&(async()=>{try{console.log("ðŸ”„ Iniciando carga de beneficiarios...");const r=await W.get("http://localhost:3000/api/ventas?populate=true");console.log("ðŸ“¦ Datos recibidos:",r.data);const l=r.data.filter(i=>i.tipo==="curso"&&i.beneficiarioId?!0:(console.log("âŒ Venta descartada - no es curso o sin beneficiario:",i.codigoVenta),!1)).map(i=>({_id:i._id,beneficiarioId:{_id:i.beneficiarioId._id,nombre:i.beneficiarioId.nombre||"Sin nombre",apellido:i.beneficiarioId.apellido||"Sin apellido"},codigoVenta:i.codigoVenta,tipo:i.tipo,numero_de_clases:i.numero_de_clases,ciclo:i.ciclo,cursoId:i.cursoId,estado:i.estado}));console.log("âœ… Beneficiarios procesados:",l.length),console.log("ðŸ“‹ Detalle beneficiarios:",l),ke(l)}catch(r){console.error("âŒ Error al cargar beneficiarios:",r),ke([])}})()},[s]),h.useEffect(()=>{(async()=>{if(s)try{console.log("ðŸ“š Cargando clases existentes...");const r=await W.get("http://localhost:3000/api/programacion_de_clases");console.log("âœ… Clases existentes cargadas:",r.data.length),_e(r.data)}catch(r){console.error("âŒ Error al cargar clases existentes:",r),_e([])}})()},[s]),h.useEffect(()=>{var a,r,l,i,I,P,v,b;if(g&&j&&he.length&&O.length){const _=((l=(r=(a=j.original)==null?void 0:a.programacionProfesor)==null?void 0:r.profesor)==null?void 0:l._id)||((I=(i=j.original)==null?void 0:i.programacionProfesor)==null?void 0:I.profesor);ie(_);const D=O.find(N=>N.id===_);q(D),K(j.especialidad);const X=(((P=j.original)==null?void 0:P.beneficiarios)||[]).map(N=>N&&typeof N=="object"&&N._id?N:he.find(me=>me._id===N)||null).filter(Boolean);G(X),fe(j.observaciones||""),le({dia:j.diaCodigo,horaInicio:j.horaInicio,horaFin:j.horaFin}),f(((b=(v=j.original)==null?void 0:v.aula)==null?void 0:b._id)||"")}else s||(K(""),G([]),fe(""),le(null),f(""),ie(""),q(null))},[g,j,s,he,O]),h.useEffect(()=>{s&&(ie(""),q(null),pe([]),le(null),G([]),K(""),fe(""),f(""))},[s]),h.useEffect(()=>{!g&&B&&(K(""),G([]),fe(""),f(""),le(null))},[B,g,O]);const $e=(a,r)=>{console.log("ðŸ”§ === GENERANDO HORARIOS POR DÃA ==="),console.log("ðŸ“Š horariosPorDia recibidos:",a),console.log("ðŸ‘¨â€ðŸ« Profesor ID:",r);const l=[],i=b=>{const[_,D]=b.split(":").map(Number);return _*60+D},I=b=>{const _=Math.floor(b/60),D=b%60;return`${_.toString().padStart(2,"0")}:${D.toString().padStart(2,"0")}`},P=xe.filter(b=>b.estado!==void 0&&b.estado!=="reprogramada"),v={};return P.forEach(b=>{const _=`${b.dia}-${b.horaInicio}-${b.horaFin}`;if(v[_]||(v[_]={profesores:new Set,aulas:new Set}),b.estado==="programada"||b.estado==="cancelada"){if(b.programacionProfesor&&b.programacionProfesor.profesor){const D=typeof b.programacionProfesor.profesor=="object"?b.programacionProfesor.profesor._id:b.programacionProfesor.profesor;v[_].profesores.add(String(D))}b.aula&&v[_].aulas.add(String(b.aula._id||b.aula))}}),a.forEach(b=>{var d;const{dia:_,horaInicio:D,horaFin:X}=b,N=Eo[_],me=i(D),o=i(X);for(let y=me;y<o;y+=60){const w=I(y),$=I(y+60);if(y+60<=o){const u=`${_}-${w}-${$}`,M=v[u]||{profesores:new Set,aulas:new Set},R=P.find(H=>H.dia===_&&H.horaInicio===w&&H.horaFin===$&&H.estado==="cancelada"&&H.programacionProfesor&&(typeof H.programacionProfesor.profesor=="object"?H.programacionProfesor.profesor._id:H.programacionProfesor.profesor)===String(r)),m=M.profesores.has(String(r)),F=ae.some(H=>!M.aulas.has(String(H._id))),z=O.some(H=>!M.profesores.has(String(H.id)));let A=!m&&F&&z,ue=A?"disponible":"ocupado",ge=m?"Profesor ya asignado en este horario":F?z?null:"Sin profesores disponibles":"Sin aulas disponibles",Ee=!1,re=null;R&&(A=!0,ue="reprogramable",ge=`Clase cancelada: ${((d=R.cursoId)==null?void 0:d.nombre)||"Sin especialidad"}`,Ee=!0,re=R._id),l.push({dia:_,diaNombre:N,horaInicio:w,horaFin:$,disponible:A,tipoOcupacion:ue,ocupadoPor:ge,esReprogramable:Ee,claseId:re})}}}),console.log("ðŸŽ¯ === RESUMEN FINAL ==="),console.log(`ðŸ“ˆ Total horarios generados: ${l.length}`),console.log(`âœ… Horarios disponibles: ${l.filter(b=>b.disponible).length}`),console.log(`âŒ Horarios ocupados: ${l.filter(b=>!b.disponible).length}`),l},Ce=async(a,r,l,i)=>{try{console.log("ðŸ”„ Reprogramando clase:",a),await W.patch(`http://localhost:3000/api/programacion_de_clases/${a}/estado`,{estado:"reprogramada"});const I=await W.get("http://localhost:3000/api/programacion_de_clases");_e(I.data),le({dia:r,horaInicio:l,horaFin:i}),console.log("âœ… Clase marcada como reprogramada y slot seleccionado automÃ¡ticamente")}catch(I){console.error("âŒ Error al reprogramar clase:",I)}};h.useEffect(()=>{(async()=>{if(!B){pe([]),q(null);return}De(!0);try{console.log("ðŸ” Generando horarios para profesor:",B);const r=O.find(I=>I.id===B);if(!r){console.warn("âš ï¸ No se encontrÃ³ data del profesor"),De(!1);return}console.log("ðŸ‘¨â€ðŸ« Datos del profesor encontrado:",r);const l={_id:r.programacionId,profesor:{_id:r.id,nombres:r.nombre.split(" ")[0]||"",apellidos:r.nombre.split(" ").slice(1).join(" ")||"",especialidades:r.especialidades||[],color:r.color||"#0455a2"},horariosPorDia:r.horariosPorDia||[]};console.log("ðŸ“‹ ProgramaciÃ³n del profesor:",l);const i=r.horariosPorDia?$e(r.horariosPorDia,B):[];q(l),pe(i),console.log("âœ… Horarios generados exitosamente:",i.length)}catch(r){console.error("âŒ Error al procesar horarios:",r),q(null),pe([])}finally{De(!1)}})()},[B,O,xe]);const{horariosGrid:uo,timeSlots:Re}=h.useMemo(()=>{const a={},r=new Set;Y.forEach(i=>{const I=`${i.horaInicio}-${i.horaFin}`;r.add(I)});const l=Array.from(r).sort();return l.forEach(i=>{a[i]={}}),Y.forEach(i=>{const I=`${i.horaInicio}-${i.horaFin}`;a[I]||(a[I]={}),a[I][i.dia]=i}),{horariosGrid:a,timeSlots:l}},[Y]),ro=(a,r,l,i)=>{i&&le({dia:a,horaInicio:r,horaFin:l})},Te=(a,r,l)=>(S==null?void 0:S.dia)===Ze[a]&&(S==null?void 0:S.horaInicio)===r&&(S==null?void 0:S.horaFin)===l,so=a=>{G(r=>r.filter(l=>l._id!==a))},ve=h.useMemo(()=>S&&S.dia&&S.horaInicio&&S.horaFin&&U.length>0&&V&&J&&(E==null?void 0:E._id),[S,U,V,J,E]),io=()=>{if(!ve)return;const a={programacionProfesor:E._id,aula:J,dia:S.dia,horaInicio:S.horaInicio,horaFin:S.horaFin,especialidad:V,beneficiarios:U.map(r=>r._id),observaciones:L||null,estado:"programada"};console.log("ðŸ“¤ Enviando nueva clase:",a),t(a),C()},ce=h.useMemo(()=>V?he.filter(a=>{const r=a.cursoId&&typeof a.cursoId=="object"?(a.cursoId.nombre||"").trim().toLowerCase():"",l=V.trim().toLowerCase(),i=(a.estado||"").toLowerCase(),I=a.tipo,P=U.some(v=>(v._id||v)===a._id);return!(I!=="curso"||!a.cursoId||typeof a.cursoId!="object"||i!=="vigente"||!r||r!==l||P)}):[],[he,V,U]),Z=h.useMemo(()=>{if(!J)return null;const a=ae.find(r=>r._id===J);return a?a.capacidad:null},[J,ae]),Ve=U.length,Ne=Z!==null&&Ve>Z;return e.jsxs(Pe,{open:s,onClose:C,fullWidth:!0,maxWidth:"xl",PaperProps:{sx:{height:"95vh",display:"flex",flexDirection:"column",borderRadius:"12px",overflow:"hidden",mt:3,bgcolor:n.palette.background.paper,border:k?`1px solid ${x(n.palette.common.white,.1)}`:"none"}},children:[e.jsxs(Me,{sx:{bgcolor:n.palette.primary.main,color:n.palette.primary.contrastText,fontWeight:600,display:"flex",alignItems:"center",gap:1,borderBottom:`1px solid ${k?x(n.palette.common.white,.1):n.palette.divider}`},children:[e.jsx(to,{sx:{mr:1}}),g?"Editar Clase":"Programar nueva clase",e.jsx(se,{onClick:C,sx:{position:"absolute",right:8,top:8,color:n.palette.primary.contrastText,"&:hover":{bgcolor:k?x(n.palette.common.white,.1):x(n.palette.common.black,.1)}},children:e.jsx(Lo,{})})]}),e.jsx(Be,{sx:{p:3,pt:3,pb:0,flex:1,overflow:"hidden",display:"flex",flexDirection:"column",minHeight:0,mt:3,maxHeight:"calc(95vh - 120px)",bgcolor:n.palette.background.default},children:e.jsxs(T,{container:!0,spacing:3,sx:{flex:1,minHeight:0},children:[e.jsxs(T,{item:!0,xs:12,lg:8,sx:{flex:1,display:"flex",flexDirection:"column",minHeight:0},children:[e.jsxs(p,{sx:{mb:2,display:"flex",alignItems:"center",gap:2},children:[e.jsxs(no,{fullWidth:!0,children:[e.jsx(lo,{children:"Seleccionar Profesor"}),e.jsx(co,{value:B,onChange:a=>ie(a.target.value),label:"Seleccionar Profesor",disabled:g,sx:{bgcolor:k?x(n.palette.background.paper,.1):n.palette.background.paper,"& .MuiOutlinedInput-notchedOutline":{borderColor:k?x(n.palette.common.white,.2):n.palette.divider},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:n.palette.primary.main},"&.Mui-focused .MuiOutlinedInput-notchedOutline":{borderColor:n.palette.primary.main}},children:O.map(a=>e.jsx(Ye,{value:a.id,children:e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(p,{sx:{width:12,height:12,borderRadius:"50%",bgcolor:a.color}}),e.jsx(je,{sx:{color:a.color,fontSize:18}}),e.jsx("span",{children:a.nombre}),e.jsx(ee,{label:a.especialidades.join(", "),size:"small",sx:{ml:1,bgcolor:x(a.color,.1),color:a.color}})]})},a.id))})]}),E&&e.jsx(ee,{label:`${((Se=E.horariosPorDia)==null?void 0:Se.length)||0} dÃ­as configurados`,color:"primary",variant:"outlined"})]}),e.jsxs(We,{elevation:1,sx:{flex:1,minHeight:0,display:"flex",flexDirection:"column",border:"1px solid #e0e0e0",borderRadius:"8px",overflow:"hidden",position:"relative"},children:[te&&e.jsx(p,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(255, 255, 255, 0.9)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:4,backdropFilter:"blur(3px)"},children:e.jsxs(p,{sx:{textAlign:"center"},children:[e.jsx(xo,{size:50,sx:{mb:2,color:"#0455a2"}}),e.jsx(c,{variant:"body1",color:"text.secondary",sx:{fontWeight:500},children:"Cargando horarios disponibles..."})]})}),e.jsx(p,{sx:{flex:1,minHeight:0,overflow:"auto",maxHeight:"550px",...ye},children:Re.length>0?e.jsxs(p,{sx:{display:"grid",gridTemplateColumns:"140px repeat(7, minmax(120px, 1fr))",minWidth:"1000px",minHeight:`${Re.length*70+60}px`,"& > *":{borderColor:n.palette.divider}},children:[e.jsxs(p,{sx:{p:1.5,borderRight:`2px solid ${n.palette.primary.main}`,borderBottom:`3px solid ${n.palette.primary.main}`,fontWeight:"bold",textAlign:"center",bgcolor:n.palette.primary.main,color:n.palette.primary.contrastText,position:"sticky",top:0,left:0,zIndex:3,boxShadow:n.shadows[2]},children:[e.jsx(to,{sx:{mb:.5,fontSize:20}}),e.jsx(c,{variant:"subtitle2",sx:{fontWeight:700,fontSize:"0.8rem"},children:"Horario"})]}),Ro.map(a=>e.jsx(p,{sx:{p:1.5,borderRight:"1px solid #e0e0e0",borderBottom:"3px solid #0455a2",fontWeight:"bold",textAlign:"center",bgcolor:"#f8f9fa",position:"sticky",top:0,zIndex:2,boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:e.jsx(c,{variant:"subtitle2",sx:{fontWeight:700,color:"#0455a2",fontSize:"0.8rem"},children:a})},a)),Re.map((a,r)=>{const[l,i]=a.split("-"),I=r%2===0;return e.jsxs(ma.Fragment,{children:[e.jsx(p,{sx:{p:1.5,borderRight:"2px solid #0455a2",borderBottom:"1px solid #e0e0e0",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:I?"#f8f9fa":"#ffffff",position:"sticky",left:0,zIndex:1,boxShadow:"1px 0 3px rgba(0,0,0,0.05)",minHeight:70},children:e.jsxs(p,{sx:{textAlign:"center"},children:[e.jsx(c,{variant:"body2",sx:{fontWeight:600,color:"#0455a2",fontSize:"0.8rem"},children:l}),e.jsx(c,{variant:"caption",color:"text.secondary",sx:{fontWeight:500,fontSize:"0.7rem"},children:i})]})}),Ro.map(P=>{var N;const v=(N=uo[a])==null?void 0:N[Ze[P]],b=(v==null?void 0:v.disponible)||!1;v!=null&&v.esReprogramable;const _=(v==null?void 0:v.tipoOcupacion)||"disponible",D=b&&Te(P,l,i);let X;return B?v?_==="disponible"?(X=e.jsx(p,{sx:{textAlign:"center",width:"100%"},children:e.jsx(c,{variant:"caption",sx:{color:D?"#1976d2":"#4caf50",fontWeight:"bold",display:"block",mb:.5,fontSize:"0.7rem"},children:D?"âœ“ Seleccionado":"âœ“ Disponible"})}),D?x("#1976d2",.2):x("#4caf50",.1),D?x("#1976d2",.3):x("#4caf50",.2)):_==="reprogramable"?(X=e.jsxs(p,{sx:{textAlign:"center",width:"100%",gap:.5},children:[e.jsx(c,{variant:"caption",sx:{color:"#ff9800",fontWeight:"bold",display:"block",mb:.5,fontSize:"0.65rem"},children:"âš ï¸ Cancelada"}),e.jsx(Q,{size:"small",variant:"contained",sx:{fontSize:"0.6rem",py:.2,px:.5,minWidth:"auto",bgcolor:"#ff9800","&:hover":{bgcolor:"#f57c00"}},onClick:me=>{me.stopPropagation(),Ce(v.claseId,Ze[P],l,i)},children:"Reprogramar"})]}),x("#ff9800",.1),x("#ff9800",.15)):(X=e.jsxs(p,{sx:{textAlign:"center",width:"100%"},children:[e.jsx(c,{variant:"caption",sx:{color:"#f44336",fontWeight:"bold",display:"block",mb:.5,fontSize:"0.7rem"},children:"âœ— Ocupado"}),e.jsx(c,{variant:"caption",sx:{color:"#f44336",fontSize:"0.6rem"},children:v.ocupadoPor})]}),x("#f44336",.1),x("#f44336",.15)):(X=e.jsx(c,{variant:"caption",sx:{color:"text.disabled",fontSize:"0.7rem"},children:"No programado"}),I?x("#bdbdbd",.05):x("#bdbdbd",.02)):X=e.jsx(Fa,{variant:"rectangular",width:"90%",height:40}),e.jsx(p,{onClick:()=>{g||B&&v&&b&&ro(Ze[P],l,i,b)},sx:{p:1,minHeight:70,borderRight:`1px solid ${n.palette.divider}`,borderBottom:`1px solid ${n.palette.divider}`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"all 0.2s ease",position:"relative",cursor:b?"pointer":"not-allowed",bgcolor:D?x(n.palette.primary.main,k?.3:.2):I?x(n.palette.background.default,k?.2:.5):n.palette.background.paper,"&:hover":b&&{bgcolor:D?x(n.palette.primary.main,k?.4:.3):x(n.palette.primary.main,k?.2:.1),transform:"scale(1.02)"},...D&&{border:`2px solid ${n.palette.primary.main}`}},children:X},`${a}-${P}`)})]},a)})]}):e.jsx(p,{sx:{p:4,textAlign:"center"},children:e.jsx(c,{variant:"body1",color:"text.secondary",children:B?"No hay horarios disponibles para este profesor":"Seleccione un profesor para ver los horarios disponibles"})})})]})]}),e.jsxs(T,{item:!0,xs:12,lg:4,sx:{display:"flex",flexDirection:"column",minHeight:0},children:[e.jsxs(c,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(zo,{color:"primary"}),"Detalles de la clase"]}),S?e.jsx(bo,{elevation:1,sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",minHeight:0,maxHeight:"calc(95vh - 200px)"},children:e.jsxs(jo,{sx:{flex:1,overflow:"auto",...ye,p:2},children:[e.jsxs(p,{sx:{mb:3},children:[e.jsx(c,{variant:"subtitle1",gutterBottom:!0,sx:{fontWeight:600},children:"ðŸ“… Horario seleccionado"}),e.jsx(ee,{label:`${Eo[S.dia]} ${S.horaInicio} - ${S.horaFin}`,color:"primary",sx:{fontWeight:500}})]}),e.jsx(Le,{sx:{my:2}}),e.jsxs(no,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(lo,{children:"Especialidad"}),e.jsx(co,{value:V,onChange:a=>{K(a.target.value),g||G([])},label:"Especialidad",disabled:g,children:(Ue=(qe=E==null?void 0:E.profesor)==null?void 0:qe.especialidades)==null?void 0:Ue.map(a=>e.jsx(Ye,{value:a,children:a},a))})]}),e.jsx(Le,{sx:{my:2}}),e.jsxs(no,{fullWidth:!0,margin:"normal",required:!0,children:[e.jsx(lo,{children:"Aula"}),e.jsxs(co,{value:J,onChange:a=>f(a.target.value),label:"Aula",disabled:g,startAdornment:e.jsx(ua,{sx:{mr:1}}),children:[g&&((Ge=j==null?void 0:j.original)==null?void 0:Ge.aula)&&!ae.some(a=>a._id===j.original.aula._id)&&e.jsxs(Ye,{value:j.original.aula._id,children:["Aula ",j.original.aula.numeroAula," (Capacidad: ",j.original.aula.capacidad,")"," - (Inactiva)"]},j.original.aula._id),ae.map(a=>{const r=xe.some(l=>l.aula&&l.aula._id===a._id&&l.dia===(S==null?void 0:S.dia)&&l.horaInicio===(S==null?void 0:S.horaInicio)&&l.horaFin===(S==null?void 0:S.horaFin)&&l.estado!=="reprogramada"&&l.estado!=="cancelada"&&l.estado!=="ejecutada"&&(!g||l._id!==(j==null?void 0:j.id)));return e.jsxs(Ye,{value:a._id,disabled:r,children:["Aula ",a.numeroAula," (Capacidad: ",a.capacidad,")",r&&" - Ocupada"]},a._id)})]})]}),e.jsx(Le,{sx:{my:2}}),e.jsxs(p,{sx:{mb:2},children:[e.jsx(c,{variant:"subtitle2",gutterBottom:!0,sx:{fontWeight:600},children:"ðŸ‘¥ Beneficiarios"}),e.jsx(ya,{multiple:!0,options:ce,value:U,isOptionEqualToValue:(a,r)=>(a._id||a)===(r._id||r),onChange:(a,r)=>G(r),getOptionLabel:a=>{var r,l;return`${((r=a.beneficiarioId)==null?void 0:r.nombre)||""} ${((l=a.beneficiarioId)==null?void 0:l.apellido)||""} - ${a.codigoVenta||""}`},filterOptions:(a,{inputValue:r})=>{const l=r.toLowerCase().split(" ");return a.filter(i=>{var v,b,_;const I=`${((v=i.beneficiarioId)==null?void 0:v.nombre)||""} ${((b=i.beneficiarioId)==null?void 0:b.apellido)||""}`.toLowerCase(),P=((_=i.codigoVenta)==null?void 0:_.toLowerCase())||"";return l.every(D=>I.includes(D)||P.includes(D))})},renderInput:a=>e.jsx(Fe,{...a,label:"Buscar beneficiarios por nombre o cÃ³digo",size:"small",fullWidth:!0,sx:{"& .MuiOutlinedInput-root":{bgcolor:k?x(n.palette.background.paper,.1):n.palette.background.paper,"& fieldset":{borderColor:k?x(n.palette.common.white,.2):n.palette.divider},"&:hover fieldset":{borderColor:n.palette.primary.main},"&.Mui-focused fieldset":{borderColor:n.palette.primary.main}}},helperText:V?ce.length===0?`No hay beneficiarios disponibles para ${V}`:`${ce.length} beneficiario(s) disponible(s) para ${V}`:"Selecciona una especialidad primero"}),disabled:!V,renderOption:(a,r)=>{var l,i;return e.jsxs(p,{component:"li",...a,sx:{"&:hover":{bgcolor:"action.hover"},cursor:"pointer",py:1},children:[e.jsx(je,{sx:{mr:1,fontSize:18,color:"primary.main"}}),e.jsxs(p,{sx:{flex:1},children:[e.jsx(c,{variant:"body2",sx:{fontWeight:500,color:"text.primary"},children:`${((l=r.beneficiarioId)==null?void 0:l.nombre)||"Sin nombre"} ${((i=r.beneficiarioId)==null?void 0:i.apellido)||"Sin apellido"}`}),e.jsxs(c,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:["CÃ³digo: ",r.codigoVenta," | Curso: ",r.cursoId&&typeof r.cursoId=="object"&&r.cursoId.nombre||"Sin curso"]})]})]})},noOptionsText:V?"No se encontraron beneficiarios":"Selecciona una especialidad primero"}),e.jsxs(Oo,{dense:!0,sx:{mt:2},children:[U.map((a,r)=>a&&a.beneficiarioId?e.jsxs(Fo,{sx:{py:1,bgcolor:k?x(n.palette.background.paper,.1):n.palette.background.paper,borderRadius:1,mb:.5,border:"1px solid",borderColor:k?x(n.palette.common.white,.1):n.palette.divider,"&:hover":{bgcolor:k?x(n.palette.action.hover,.2):n.palette.action.hover,borderColor:n.palette.primary.main}},children:[e.jsx(Ho,{sx:{minWidth:36},children:e.jsx(je,{fontSize:"small",color:"primary"})}),e.jsx(To,{primary:e.jsx(c,{variant:"body2",sx:{fontWeight:500,color:"text.primary"},children:`${a.beneficiarioId.nombre||"Sin nombre"} ${a.beneficiarioId.apellido||"Sin apellido"}`}),secondary:e.jsx(c,{variant:"caption",sx:{color:"text.secondary"},children:`${a.codigoVenta} | ${a.cursoId&&typeof a.cursoId=="object"&&a.cursoId.nombre||"Sin curso"} | ${a.numero_de_clases||0} clases`})}),e.jsx(se,{edge:"end","aria-label":"delete",onClick:()=>so(a._id),size:"small",sx:{color:"error.main","&:hover":{bgcolor:"error.light",color:"error.dark"}},children:e.jsx(No,{fontSize:"small"})})]},a._id||r):null),U.length===0&&e.jsx(c,{variant:"body2",sx:{textAlign:"center",color:"text.secondary",py:2,bgcolor:"action.hover",borderRadius:1},children:"No hay beneficiarios seleccionados"})]})]}),e.jsx(Le,{sx:{my:2}}),e.jsx(Fe,{label:"Observaciones (Opcional)",multiline:!0,rows:3,fullWidth:!0,value:L,onChange:a=>fe(a.target.value),sx:{mb:2,"& .MuiOutlinedInput-root":{bgcolor:k?x(n.palette.background.paper,.1):n.palette.background.paper,"& fieldset":{borderColor:k?x(n.palette.common.white,.2):n.palette.divider},"&:hover fieldset":{borderColor:n.palette.primary.main},"&.Mui-focused fieldset":{borderColor:n.palette.primary.main}}}}),(E==null?void 0:E.profesor)&&e.jsxs(p,{sx:{mt:2,p:2,bgcolor:k?x(n.palette.primary.main,.15):x("#0455a2",.05),borderRadius:1,border:k?`1px solid ${x(n.palette.primary.main,.2)}`:"none"},children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1,mb:1},children:[e.jsx(zo,{fontSize:"small",color:"info"}),e.jsx(c,{variant:"caption",sx:{fontWeight:600},children:"InformaciÃ³n del profesor"})]}),e.jsxs(c,{variant:"caption",display:"block",children:["ðŸ‘¨â€ðŸ« ",((Je=E.profesor)==null?void 0:Je.nombres)||""," ",((Xe=E.profesor)==null?void 0:Xe.apellidos)||""]}),e.jsxs(c,{variant:"caption",display:"block",children:["ðŸŽ¯ Especialidades: ",((Ie=(Qe=E.profesor)==null?void 0:Qe.especialidades)==null?void 0:Ie.join(", "))||"No especificadas"]}),e.jsxs(c,{variant:"caption",display:"block",children:["ðŸ“… Horarios configurados: ",((we=E.horariosPorDia)==null?void 0:we.length)||0," dÃ­as"]})]})]})}):e.jsx(bo,{sx:{mt:2},children:e.jsxs(jo,{sx:{textAlign:"center",py:4},children:[e.jsx(to,{sx:{fontSize:48,color:"text.secondary",mb:2}}),e.jsx(c,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:B?"Seleccione un horario disponible en la cuadrÃ­cula":"Seleccione un profesor para ver los horarios disponibles"}),B&&e.jsx(c,{variant:"caption",color:"text.secondary",children:'Nota: Solo se muestran beneficiarios de ventas tipo "curso"'})]})})]})]})}),e.jsxs(Oe,{sx:{p:3,borderTop:`1px solid ${k?x(n.palette.common.white,.1):n.palette.divider}`,flexShrink:0,gap:2,bgcolor:n.palette.background.paper},children:[e.jsx(Q,{onClick:C,color:"secondary",sx:{textTransform:"none",px:3,py:1},children:"Cancelar"}),e.jsxs(p,{sx:{position:"relative",display:"inline-flex"},children:[e.jsx(Q,{onClick:async()=>{if(!ne){ze(!0);try{await io()}finally{ze(!1)}}},variant:"contained",disabled:!ve||Ne||ne,sx:{bgcolor:"#0455a2","&:hover":{bgcolor:"#034589"},textTransform:"none",px:3,py:1,fontWeight:600},children:g?"Guardar Cambios":"Programar Clase"}),ne&&e.jsx(xo,{size:24,sx:{position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px"}})]})]}),Ne&&e.jsx(p,{sx:{px:3,pb:2},children:e.jsxs(c,{color:"error",variant:"body2",sx:{fontWeight:600},children:["La cantidad de beneficiarios supera la capacidad mÃ¡xima del aula seleccionada (",Z,")."]})})]})};Vo.locale("es");const Po=["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado","Domingo"],Ja={L:"Lunes",M:"Martes",X:"MiÃ©rcoles",J:"Jueves",V:"Viernes",S:"SÃ¡bado",D:"Domingo"},Xa=["06:00 - 07:00","07:00 - 08:00","08:00 - 09:00","09:00 - 10:00","10:00 - 11:00","11:00 - 12:00","12:00 - 13:00","13:00 - 14:00","14:00 - 15:00","15:00 - 16:00","16:00 - 17:00","17:00 - 18:00","18:00 - 19:00","19:00 - 20:00","20:00 - 21:00","21:00 - 22:00","22:00 - 23:00"],be=s=>{const C=["#4f46e5","#0891b2","#7c3aed","#16a34a","#ea580c","#db2777","#9333ea","#0284c7","#65a30d","#0d9488"];let t=0;if(!s)return"#cccccc";for(let j=0;j<s.length;j++)t=s.charCodeAt(j)+((t<<5)-t);const g=Math.abs(t)%C.length;return C[g]},lr=()=>{const s=Bo(),{darkMode:C}=h.useContext(Wo),{user:t,hasPrivilege:g}=ga(),j=(t==null?void 0:t.role)==="beneficiario",oe=g==null?void 0:g("programacion_de_clases","crear"),O=g==null?void 0:g("programacion_de_clases","editar"),de=g==null?void 0:g("programacion_de_clases","eliminar"),B=g==null?void 0:g("programacion_de_clases","editar"),ie=(g==null?void 0:g("programacion_de_clases","editar"))||(g==null?void 0:g("asistencia","crear"))||(g==null?void 0:g("asistencia","editar")),E=()=>j?"Mis Clases Programadas":"ProgramaciÃ³n de Clases",[q,Y]=h.useState([]),[pe,S]=h.useState([]),[le,he]=h.useState([]),[ke,U]=h.useState([]),[G,V]=h.useState(""),[K,L]=h.useState({open:!1,message:"",severity:"success"}),[fe,te]=h.useState(!1),[De,xe]=h.useState(!1),[_e,ae]=h.useState(!1),[He,J]=h.useState(!1),[f,ne]=h.useState(null),[ze,n]=h.useState(null),[k,ye]=h.useState(""),[$e,Ce]=h.useState({}),[uo,Re]=h.useState(new Date),[ro,Te]=h.useState(!0),[so,ve]=h.useState(!1),[io,ce]=h.useState(!1),[Z,Ve]=h.useState(null),[Ne,Se]=h.useState(!1),[qe,Ue]=h.useState([]),[Ge,Je]=h.useState(""),[Xe,Qe]=h.useState("");h.useEffect(()=>{(async()=>{try{Te(!0),console.log("ðŸ”„ Iniciando carga de datos...");let d;if((t==null?void 0:t.role)==="profesor"){d=await W.get("http://localhost:3000/api/programacion_de_clases");const m=d.data.filter(F=>{var A;const z=(A=F.programacionProfesor)==null?void 0:A.profesor;return(z==null?void 0:z.correo)===t.email});console.log("âœ… Clases filtradas para profesor:",m),console.log("ðŸ“§ Email del usuario:",t.email),Y(m)}else d=await W.get("http://localhost:3000/api/programacion_de_clases"),console.log("âœ… Clases cargadas:",d.data),Y(d.data);const y=await W.get("http://localhost:3000/api/profesores");S(y.data);const $=(await W.get("http://localhost:3000/api/aulas")).data.filter(R=>R.estado==="Activo"||R.estado==="Disponible");U($);const u=await W.get("http://localhost:3000/api/ventas?populate=true");console.log("ðŸ“¦ Ventas recibidas:",u.data);const M=u.data.filter(R=>R.tipo==="curso");console.log("âœ… Beneficiarios de cursos:",M),he(M)}catch(d){console.error("Error al cargar datos:",d),L({open:!0,message:"Error al cargar los datos",severity:"error"})}finally{Te(!1)}})()},[t]);const Ie=h.useMemo(()=>(console.log("ðŸ”„ Procesando clases:",q),console.log("ðŸ“¦ Beneficiarios disponibles:",le),console.log("ðŸ‘¤ Usuario actual:",t),q.filter(o=>{var y,w,$,u,M,R;const d=o.especialidad&&o.especialidad.trim()!==""&&((y=o.beneficiarios)==null?void 0:y.length)>0&&((w=o.programacionProfesor)==null?void 0:w.profesor)&&o.estado!=="reprogramada"&&o.estado!=="ejecutada";if((t==null?void 0:t.role)==="profesor"&&d){const m=($=o.programacionProfesor)==null?void 0:$.profesor;if(!((m==null?void 0:m.correo)===t.email))return console.log("âŒ Clase filtrada para profesor (no es su clase):",{id:o._id,especialidad:o.especialidad,profesorClase:m==null?void 0:m.correo,userEmail:t.email}),!1}if(j&&d){if(!((u=o.beneficiarios)==null?void 0:u.some(F=>{if(F!=null&&F.beneficiarioId){const z=F.beneficiarioId;return z.numero_de_documento===(t==null?void 0:t.documento)||z.email===(t==null?void 0:t.email)||z._id===(t==null?void 0:t.id)||z.correo===(t==null?void 0:t.email)}return!1})))return console.log("âŒ Clase filtrada para beneficiario (no inscrito):",{id:o._id,especialidad:o.especialidad,userDocumento:t==null?void 0:t.documento,userEmail:t==null?void 0:t.email,userID:t==null?void 0:t.id}),!1;console.log("âœ… Clase aprobada para beneficiario:",{id:o._id,especialidad:o.especialidad,userDocumento:t==null?void 0:t.documento,userEmail:t==null?void 0:t.email})}return d||console.log("âŒ Clase filtrada:",{id:o._id,especialidad:o.especialidad,beneficiarios:(M=o.beneficiarios)==null?void 0:M.length,profesor:!!((R=o.programacionProfesor)!=null&&R.profesor),estado:o.estado}),d}).map(o=>{var $;const d=($=o.programacionProfesor)==null?void 0:$.profesor,y=o.aula,w=(o.beneficiarios||[]).map(u=>{var M,R;return!u||!u.beneficiarioId?{id:(u==null?void 0:u._id)||"N/A",nombre:"Sin beneficiario",tipo:"Beneficiario",codigoVenta:(u==null?void 0:u.codigoVenta)||"-",curso:(typeof(u==null?void 0:u.cursoId)=="object"?(M=u==null?void 0:u.cursoId)==null?void 0:M.nombre:u==null?void 0:u.cursoId)||"-"}:{id:u._id,nombre:`${u.beneficiarioId.nombre||""} ${u.beneficiarioId.apellido||""}`.trim()||"Sin nombre",tipo:"Beneficiario",codigoVenta:u.codigoVenta||"-",curso:(typeof u.cursoId=="object"?(R=u.cursoId)==null?void 0:R.nombre:u.cursoId)||"-"}});return{id:o._id,dia:Ja[o.dia]||o.dia,diaCodigo:o.dia,hora:`${o.horaInicio} - ${o.horaFin}`,horaInicio:o.horaInicio,horaFin:o.horaFin,clase:o.especialidad,especialidad:o.especialidad,profesor:d?`${d.nombres||""} ${d.apellidos||""}`:"Sin profesor",profesorColor:(d==null?void 0:d.color)||"#0455a2",aula:(y==null?void 0:y.numeroAula)||"Sin aula",aulaId:y==null?void 0:y._id,beneficiarios:w.map(u=>u.nombre),todosLosEstudiantes:w,totalBeneficiarios:w.length,estado:o.estado,fecha:o.fecha,observaciones:o.observaciones,asistencia:o.asistencia,motivo:o.motivo,fechaCreacion:o.createdAt,fechaActualizacion:o.updatedAt,original:o}})),[q]),we=h.useMemo(()=>G?Ie.filter(o=>[o.dia,o.hora,o.clase,o.profesor,...o.beneficiarios].join(" ").toLowerCase().includes(G.toLowerCase())):Ie,[Ie,G]),a=h.useMemo(()=>{const o={};return we.forEach(d=>{const y=`${d.dia}-${d.hora}`;o[y]||(o[y]=[]),o[y].push(d)}),o},[we]),r=o=>{Ve(o),ce(!0)},l=o=>{n({...o}),xe(!0)},i=o=>{ne(o),ye(""),ae(!0)},I=o=>{ne(o);const d={};o.todosLosEstudiantes.forEach(y=>{d[y.id]={asistio:!1,motivo:""}}),Ce(d),J(!0)},P=async()=>{if(Z){if(Z.todosLosEstudiantes.length>0){L({open:!0,message:"No se puede eliminar una clase con beneficiarios asignados",severity:"warning"}),ce(!1);return}try{await W.delete(`http://localhost:3000/api/programacion_de_clases/${Z.id}`),await D(),L({open:!0,message:"Clase eliminada correctamente",severity:"success"})}catch(o){console.error("Error al eliminar:",o),L({open:!0,message:"Error al eliminar la clase",severity:"error"})}finally{ce(!1),Ve(null),te(!1)}}},v=async()=>{if(!(!f||!k.trim()))try{await W.patch(`http://localhost:3000/api/programacion_de_clases/${f.id}/estado`,{estado:"cancelada",motivo:k.trim()}),await D(),L({open:!0,message:"Clase cancelada correctamente",severity:"success"})}catch(o){console.error("Error al cancelar:",o),L({open:!0,message:"Error al cancelar la clase",severity:"error"})}finally{ae(!1),ne(null),ye(""),te(!1)}},b=async()=>{var o,d,y,w,$,u,M,R,m,F,z;if(f)try{const A=Object.entries($e).map(([re,H])=>({ventaId:re,estado:H.asistio?"asistio":"no_asistio",motivo:H.motivo||null}));console.log("ðŸ“¤ Datos de asistencia a enviar:",{programacionClaseId:f.id,asistencias:A}),console.log("ðŸ”„ Registrando asistencias...");const ue=`http://localhost:3000/api/asistencias/programacion/${f.id}/bulk`;console.log("ðŸŒ URL de asistencia:",ue),console.log("ðŸ“‹ Datos a enviar a asistencia:",{asistencias:A});const ge=await W.put(ue,{asistencias:A});console.log("âœ… Respuesta del servidor (asistencias):",ge.data),console.log("ðŸ”„ Marcando clase como ejecutada automÃ¡ticamente...");const Ee=`http://localhost:3000/api/programacion_de_clases/${f.id}/estado`;console.log("ðŸŒ URL de estado:",Ee),console.log("ðŸ“‹ Datos a enviar a estado:",{estado:"ejecutada"});try{await W.patch(Ee,{estado:"ejecutada"}),console.log("âœ… Clase marcada como ejecutada"),await X()}catch(re){console.error("âš ï¸ Error al marcar clase como ejecutada:",re),console.error("âš ï¸ URL que fallÃ³:",(o=re.config)==null?void 0:o.url),console.error("âš ï¸ MÃ©todo que fallÃ³:",(d=re.config)==null?void 0:d.method),console.error("âš ï¸ Datos enviados:",(y=re.config)==null?void 0:y.data),console.error("âš ï¸ Respuesta del error:",(w=re.response)==null?void 0:w.data)}await D(),L({open:!0,message:"Asistencia registrada correctamente",severity:"success"})}catch(A){console.error("âŒ Error al registrar asistencia:",A),console.error("âŒ URL que fallÃ³:",($=A.config)==null?void 0:$.url),console.error("âŒ MÃ©todo que fallÃ³:",(u=A.config)==null?void 0:u.method),console.error("âŒ Datos enviados:",(M=A.config)==null?void 0:M.data),console.error("âŒ Respuesta del error:",(R=A.response)==null?void 0:R.data),console.error("âŒ Status del error:",(m=A.response)==null?void 0:m.status),console.error("ðŸ“‹ Error en registro de asistencias - Datos enviados:",{programacionClaseId:f.id,asistencias:Object.entries($e).map(([ue,ge])=>({ventaId:ue,estado:ge.asistio?"asistio":"no_asistio",motivo:ge.motivo||null}))}),L({open:!0,message:`Error al registrar asistencias: ${((z=(F=A.response)==null?void 0:F.data)==null?void 0:z.message)||A.message}`,severity:"error"})}finally{J(!1),ne(null),Ce({}),te(!1)}},_=async o=>{var d,y,w,$;try{if(console.log("ðŸ“¤ Enviando nueva clase al backend:",o),!o.programacionProfesor)throw new Error("El profesor es requerido");if(!o.dia||!o.horaInicio||!o.horaFin)throw new Error("El horario es requerido (dÃ­a y horas)");if(!o.especialidad)throw new Error("La especialidad es requerida");if(!((d=o.beneficiarios)!=null&&d.length))throw new Error("Al menos un beneficiario es requerido");if(!o.aula)throw new Error("El aula es requerida");const u=await W.post("http://localhost:3000/api/programacion_de_clases",o);console.log("âœ… Respuesta del servidor:",u.data),Y(M=>[u.data,...M]),await D(),L({open:!0,message:"Clase programada correctamente",severity:"success"})}catch(u){console.error("âŒ Error al crear clase:",u),console.error("ðŸ“‹ Datos enviados:",o),console.error("ðŸ“‹ Respuesta del error:",(y=u.response)==null?void 0:y.data),L({open:!0,message:`Error al programar la clase: ${(($=(w=u.response)==null?void 0:w.data)==null?void 0:$.message)||u.message}`,severity:"error"})}},D=async()=>{try{const o=await W.get("http://localhost:3000/api/programacion_de_clases");Y(o.data)}catch(o){console.error("Error al recargar clases:",o)}},X=async()=>{try{const d=(await W.get("http://localhost:3000/api/aulas")).data.filter(y=>y.estado==="Activo"||y.estado==="Disponible");U(d)}catch(o){console.error("Error al recargar aulas:",o)}},N=async o=>{try{await W.put(`http://localhost:3000/api/programacion_de_clases/${ze.id}`,{beneficiarios:o.beneficiarios}),await D(),L({open:!0,message:"Beneficiarios actualizados correctamente",severity:"success"}),xe(!1)}catch{L({open:!0,message:"Error al actualizar beneficiarios",severity:"error"})}},me=()=>e.jsxs(p,{sx:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(p,{sx:{display:"grid",gridTemplateColumns:"120px repeat(7, 1fr)",bgcolor:s.palette.primary.main,color:"white",borderBottom:`2px solid ${s.palette.primary.dark}`,position:"sticky",top:0,zIndex:10,boxShadow:s.shadows[3]},children:[e.jsxs(p,{sx:{p:1.5,borderRight:`1px solid ${x(s.palette.common.white,.2)}`,fontWeight:"bold",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:s.palette.primary.main},children:[e.jsx(po,{sx:{mr:.5,fontSize:18}}),e.jsx(c,{variant:"subtitle2",sx:{fontWeight:700,fontSize:"0.85rem"},children:"Horarios"})]}),Po.map((o,d)=>e.jsxs(p,{sx:{p:1.5,textAlign:"center",borderRight:`1px solid ${x(s.palette.common.white,.2)}`,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",bgcolor:s.palette.primary.main},children:[e.jsx(c,{variant:"subtitle1",sx:{fontWeight:700,fontSize:"0.9rem",mb:.3},children:o}),e.jsx(c,{variant:"caption",sx:{opacity:.8,fontSize:"0.65rem"},children:Vo().startOf("week").add(d+1,"day").format("DD/MM")})]},o))]}),e.jsx(p,{sx:{flexGrow:1,overflow:"auto","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",msOverflowStyle:"none"},children:e.jsx(p,{sx:{minWidth:"900px"},children:Xa.map((o,d)=>{const y=d%2===0;return e.jsxs(p,{sx:{display:"grid",gridTemplateColumns:"120px repeat(7, 1fr)",borderBottom:`1px solid ${s.palette.divider}`,minHeight:"80px","&:hover":{bgcolor:x(s.palette.primary.main,.05),transition:"all 0.2s ease"}},children:[e.jsx(p,{sx:{p:1.5,borderRight:`1px solid ${s.palette.primary.main}`,display:"flex",alignItems:"center",justifyContent:"center",bgcolor:y?x(s.palette.background.default,.5):s.palette.background.paper,position:"sticky",left:0,zIndex:1,boxShadow:s.shadows[1]},children:e.jsxs(p,{sx:{textAlign:"center"},children:[e.jsx(c,{variant:"body2",sx:{fontWeight:600,color:s.palette.primary.main,fontSize:"0.85rem"},children:o.split(" - ")[0]}),e.jsx(c,{variant:"caption",color:"text.secondary",sx:{fontWeight:500,fontSize:"0.7rem"},children:o.split(" - ")[1]})]})}),Po.map(w=>{const $=`${w}-${o}`,u=Array.isArray(a[$])?a[$]:[],M=u.length>0,R=M?[...u].sort((z,A)=>A.totalBeneficiarios-z.totalBeneficiarios):[],m=R[0]||null,F=(m==null?void 0:m.totalBeneficiarios)||0;return e.jsx(p,{sx:{p:1,borderRight:`1px solid ${s.palette.divider}`,height:"100%",minHeight:"80px",position:"relative",bgcolor:y?x(s.palette.background.default,.5):s.palette.background.paper},children:M&&m?e.jsxs(p,{sx:{position:"relative",height:"100%"},children:[R.length>1&&e.jsx(p,{sx:{position:"absolute",top:4,right:4,zIndex:2},children:e.jsx(yo,{title:"Ver todas las programaciones de este horario",children:e.jsx(ee,{label:`+${R.length-1}`,size:"small",color:"primary",sx:{fontSize:"0.7rem",height:18,cursor:"pointer"},onClick:z=>{z.stopPropagation(),Ue(R),Je(w),Qe(o),Se(!0)}})})}),e.jsxs(We,{elevation:0,sx:{height:"100%",p:1,bgcolor:m.estado==="cancelada"?x(s.palette.grey[500],.15):x(be(m.especialidad),.15),borderLeft:`4px solid ${m.estado==="cancelada"?s.palette.grey[500]:be(m.especialidad)}`,borderRadius:"6px",display:"flex",flexDirection:"column",justifyContent:"space-between",transition:"all 0.2s ease",position:"relative",cursor:"pointer",opacity:m.estado==="cancelada"?.7:1,"&:hover":{bgcolor:m.estado==="cancelada"?x(s.palette.grey[500],.25):x(be(m.especialidad),.25),transform:m.estado==="cancelada"?"none":"translateY(-2px)",boxShadow:m.estado==="cancelada"?"none":s.shadows[4]}},onClick:()=>{ne(m),te(!0)},children:[e.jsxs(c,{variant:"subtitle2",sx:{fontWeight:"bold",mb:.3,fontSize:"0.8rem"},children:[m.especialidad,m.estado==="cancelada"&&e.jsx(ee,{label:"CANCELADA",size:"small",color:"error",sx:{ml:.5,fontSize:"0.6rem",height:16,"& .MuiChip-label":{px:.5}}})]}),e.jsxs(p,{sx:{display:"flex",flexDirection:"column",gap:.3},children:[e.jsxs(c,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.3,fontSize:"0.7rem"},children:[e.jsx(je,{fontSize:"inherit"}),m.profesor]}),e.jsxs(c,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.3,fontSize:"0.7rem"},children:[e.jsx(Ae,{fontSize:"inherit"}),"Aula: ",m.aula]}),e.jsxs(c,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.3,fontSize:"0.7rem"},children:[e.jsx(ho,{fontSize:"inherit"}),e.jsx(Io,{badgeContent:F,color:"primary",sx:{"& .MuiBadge-badge":{fontSize:"0.55rem",height:12,minWidth:12}},children:e.jsx(c,{variant:"caption",sx:{fontSize:"0.7rem"},children:"Beneficiarios"})})]})]}),e.jsxs(p,{sx:{display:"flex",justifyContent:"flex-end",mt:.5,gap:.3},children:[B&&e.jsx(se,{size:"small",color:"warning",onClick:z=>{z.stopPropagation(),i(m)},disabled:m.estado==="cancelada",sx:{p:.3,"&:hover":{bgcolor:m.estado==="cancelada"?"transparent":x("#ff9800",.1)},opacity:m.estado==="cancelada"?.3:1},children:e.jsx(Ke,{sx:{fontSize:14}})}),!j&&e.jsxs(e.Fragment,{children:[O&&e.jsx(se,{size:"small",color:"primary",onClick:z=>{z.stopPropagation(),l(m)},disabled:m.estado==="cancelada",sx:{p:.3,"&:hover":{bgcolor:m.estado==="cancelada"?"transparent":x("#1976d2",.1)},opacity:m.estado==="cancelada"?.3:1},children:e.jsx(Co,{sx:{fontSize:14}})}),de&&e.jsx(se,{size:"small",color:"error",onClick:z=>{z.stopPropagation(),r(m)},disabled:m.estado==="cancelada",sx:{p:.3,"&:hover":{bgcolor:m.estado==="cancelada"?"transparent":x("#f44336",.1)},opacity:m.estado==="cancelada"?.3:1},children:e.jsx(vo,{sx:{fontSize:14}})})]})]}),e.jsx(p,{sx:{position:"absolute",top:3,right:3,width:8,height:8,borderRadius:"50%",bgcolor:m.estado==="ejecutada"?"#4caf50":m.estado==="cancelada"?"#f44336":m.estado==="programada"?"#2196f3":"#ffc107",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}})]})]}):!j&&oe&&e.jsx(p,{sx:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center",opacity:.3,transition:"all 0.2s ease","&:hover":{opacity:.8,bgcolor:x(s.palette.primary.main,.05),borderRadius:"6px"}},children:e.jsx(yo,{title:"Agregar clase",arrow:!0,children:e.jsx(se,{size:"small",onClick:()=>ve(!0),sx:{"&:hover":{bgcolor:x(s.palette.primary.main,.1)}},children:e.jsx(So,{sx:{fontSize:18}})})})})},`${o}-${w}`)})]},o)})})})]});return e.jsxs(p,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:"column",mt:2},children:[e.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,pb:1,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(c,{variant:"h5",component:"h1",sx:{fontWeight:500},children:E()}),e.jsxs(p,{sx:{display:"flex",gap:1},children:[e.jsx(Fe,{placeholder:"Buscar...",size:"small",value:G,onChange:o=>V(o.target.value),InputProps:{startAdornment:e.jsx(va,{position:"start",children:e.jsx(Sa,{})})},sx:{width:{xs:"120px",sm:"200px"}}}),!j&&oe&&e.jsx(Q,{variant:"contained",startIcon:e.jsx(So,{}),onClick:()=>ve(!0),sx:{bgcolor:"#0455a2",textTransform:"none","&:hover":{bgcolor:"#033b70"}},children:"Nueva Clase"})]})]}),e.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:2,px:1,py:.5,borderBottom:"1px solid #e0e0e0"},children:[e.jsx(p,{sx:{display:"flex",alignItems:"center"},children:e.jsx(Q,{variant:"text",onClick:()=>Re(new Date),sx:{textTransform:"none",color:"#1a73e8",minWidth:"auto",px:1,fontSize:"0.875rem"},children:"Hoy"})}),e.jsx(p,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsx(ee,{label:`${we.length} clases`,color:"primary",variant:"outlined",size:"small"})})]}),e.jsx(We,{elevation:0,sx:{flexGrow:1,borderRadius:"12px",boxShadow:"0 4px 20px rgba(0,0,0,0.1)",overflow:"hidden",display:"flex",flexDirection:"column"},children:ro?e.jsxs(p,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:[e.jsx(xo,{size:50,sx:{color:"#0455a2"}}),e.jsx(c,{variant:"body1",sx:{ml:2,fontWeight:500},children:"Cargando programaciÃ³n..."})]}):me()}),e.jsx(Pe,{open:fe,onClose:()=>te(!1),maxWidth:"md",fullWidth:!0,children:f&&e.jsxs(e.Fragment,{children:[e.jsxs(Me,{sx:{backgroundColor:be(f.especialidad),color:"white",fontWeight:"bold",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(p,{children:"Detalles de la Clase"}),e.jsx(se,{onClick:()=>te(!1),sx:{color:"white"},children:e.jsx(Lo,{})})]}),e.jsx(Be,{sx:{mt:2},children:e.jsxs(T,{container:!0,spacing:2,children:[e.jsx(T,{item:!0,xs:12,children:e.jsx(c,{variant:"h6",sx:{mb:2,color:be(f.especialidad)},children:f.especialidad})}),e.jsx(T,{item:!0,xs:6,children:e.jsxs(c,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5,mb:1},children:[e.jsx(po,{fontSize:"inherit"}),e.jsx("strong",{children:"DÃ­a:"})," ",f.dia]})}),e.jsx(T,{item:!0,xs:6,children:e.jsxs(c,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5,mb:1},children:[e.jsx(po,{fontSize:"inherit"}),e.jsx("strong",{children:"Hora:"})," ",f.hora]})}),e.jsx(T,{item:!0,xs:6,children:e.jsxs(c,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5,mb:1},children:[e.jsx(je,{fontSize:"inherit"}),e.jsx("strong",{children:"Profesor:"})," ",f.profesor]})}),e.jsx(T,{item:!0,xs:6,children:e.jsxs(c,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5,mb:1},children:[e.jsx(Ae,{fontSize:"inherit"}),e.jsx("strong",{children:"Aula:"})," ",f.aula]})}),e.jsxs(T,{item:!0,xs:12,children:[e.jsxs(c,{variant:"body2",sx:{display:"flex",alignItems:"center",gap:.5,mb:2},children:[e.jsx(ho,{fontSize:"inherit"}),e.jsxs("strong",{children:["Beneficiarios (",f.totalBeneficiarios,"):"]})]}),e.jsx(Oo,{dense:!0,sx:{bgcolor:"#f8f9fa",borderRadius:1,maxHeight:200,overflow:"auto"},children:Array.isArray(f==null?void 0:f.todosLosEstudiantes)&&f.todosLosEstudiantes.map((o,d)=>e.jsxs(Fo,{sx:{py:.5},children:[e.jsx(Ho,{sx:{minWidth:30},children:e.jsx(je,{fontSize:"small",color:o.tipo==="Beneficiario"?"primary":"secondary"})}),e.jsx(To,{primary:o.nombre,secondary:`${o.tipo} - ${o.codigoVenta}`,primaryTypographyProps:{fontSize:"0.9rem"},secondaryTypographyProps:{fontSize:"0.75rem"}}),o.tipo==="Beneficiario"&&e.jsx(ee,{label:"Beneficiario",size:"small",color:"primary",sx:{ml:1}})]},d))})]}),e.jsx(T,{item:!0,xs:12,children:(f==null?void 0:f.estado)&&e.jsx(ee,{label:f.estado.charAt(0).toUpperCase()+f.estado.slice(1),color:f.estado==="ejecutada"?"success":f.estado==="cancelada"?"error":f.estado==="programada"?"info":"default",sx:{mb:2}})}),f.observaciones&&e.jsx(T,{item:!0,xs:12,children:e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Observaciones:"})," ",f.observaciones]})}),f.motivo&&e.jsx(T,{item:!0,xs:12,children:e.jsxs(c,{variant:"body2",children:[e.jsx("strong",{children:"Motivo:"})," ",f.motivo]})})]})}),e.jsxs(Oe,{sx:{p:2},children:[ie&&e.jsx(Q,{variant:"contained",startIcon:e.jsx(Ae,{}),onClick:()=>I(f),disabled:f.estado==="cancelada",sx:{backgroundColor:f.estado==="cancelada"?"#9e9e9e":"#4caf50","&:hover":{backgroundColor:f.estado==="cancelada"?"#9e9e9e":"#388e3c"},mr:1},children:f.estado==="cancelada"?"Clase Cancelada":"Registrar Asistencia"}),e.jsx(Q,{variant:"contained",onClick:()=>te(!1),sx:{backgroundColor:"#0455a2","&:hover":{backgroundColor:"#033b7a"}},children:"Cerrar"})]})]})}),e.jsxs(Pe,{open:He,onClose:()=>J(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Me,{sx:{bgcolor:"#4caf50",color:"white"},children:e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ae,{}),"Registrar Asistencia"]})}),e.jsx(Be,{sx:{mt:2},children:f&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"body1",sx:{mb:2},children:[e.jsx("strong",{children:"Clase:"})," ",f.especialidad]}),e.jsxs(c,{variant:"body2",sx:{mb:3},children:[e.jsx("strong",{children:"Horario:"})," ",f.dia," - ",f.hora]}),e.jsx(Le,{sx:{mb:2}}),e.jsx(c,{variant:"h6",sx:{mb:2},children:"Marcar asistencia de beneficiarios:"}),e.jsx(p,{sx:{maxHeight:400,overflow:"auto"},children:f.todosLosEstudiantes.map(o=>{const d=$e[o.id]||{asistio:!1,motivo:""};return e.jsxs(We,{sx:{p:2,mb:2,border:"1px solid #e0e0e0"},children:[e.jsxs(p,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(ka,{checked:d.asistio,onChange:y=>Ce(w=>{var $;return{...w,[o.id]:{...w[o.id],asistio:y.target.checked,motivo:y.target.checked?"":(($=w[o.id])==null?void 0:$.motivo)||""}}}),icon:e.jsx(Ha,{}),checkedIcon:e.jsx(Ia,{}),sx:{color:"#4caf50","&.Mui-checked":{color:"#4caf50"}}}),e.jsxs(p,{sx:{flex:1,ml:1},children:[e.jsx(c,{variant:"body1",sx:{fontWeight:500},children:o.nombre}),e.jsxs(c,{variant:"caption",color:"text.secondary",children:[o.tipo," - ",o.codigoVenta]}),o.tipo==="Beneficiario"&&e.jsx(ee,{label:"Beneficiario",size:"small",color:"primary",sx:{ml:1}})]}),e.jsx(ee,{label:d.asistio?"AsistiÃ³":"No asistiÃ³",color:d.asistio?"success":"error",size:"small"})]}),!d.asistio&&e.jsx(Fe,{label:"Motivo de inasistencia",value:d.motivo,onChange:y=>Ce(w=>({...w,[o.id]:{...w[o.id],motivo:y.target.value}})),fullWidth:!0,size:"small",multiline:!0,rows:2,placeholder:"Ej: Enfermedad, viaje, etc.",sx:{mt:1},required:!d.asistio})]},o.id)})})]})}),e.jsxs(Oe,{sx:{p:2},children:[e.jsx(Q,{onClick:()=>J(!1),children:"Cancelar"}),ie&&e.jsx(Q,{variant:"contained",startIcon:e.jsx(Ta,{}),onClick:b,sx:{bgcolor:"#4caf50","&:hover":{bgcolor:"#388e3c"}},children:"Guardar Asistencia"})]})]}),e.jsx(Ao,{isOpen:De,onClose:()=>xe(!1),onSubmit:N,editMode:!0,claseAEditar:ze,aulas:ke}),e.jsxs(Pe,{open:_e,onClose:()=>ae(!1),maxWidth:"sm",fullWidth:!0,children:[e.jsx(Me,{sx:{bgcolor:"#ff9800",color:"white"},children:e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(Ke,{}),"Cancelar Clase"]})}),e.jsxs(Be,{sx:{mt:2},children:[e.jsx(c,{variant:"body1",sx:{mb:2},children:"Â¿EstÃ¡ seguro de cancelar esta clase?"}),f&&e.jsxs(p,{sx:{mb:2,p:2,bgcolor:"#f5f5f5",borderRadius:1},children:[e.jsx(c,{variant:"subtitle2",children:f.especialidad}),e.jsxs(c,{variant:"body2",children:[f.dia," - ",f.hora]}),e.jsxs(c,{variant:"body2",children:["Profesor: ",f.profesor]})]}),e.jsx(Fe,{label:"Motivo de cancelaciÃ³n",value:k,onChange:o=>ye(o.target.value),fullWidth:!0,multiline:!0,rows:3,required:!0,helperText:"Por favor, indique el motivo de la cancelaciÃ³n"})]}),e.jsxs(Oe,{sx:{p:2},children:[e.jsx(Q,{onClick:()=>ae(!1),children:"Cancelar"}),B&&e.jsx(Q,{variant:"contained",color:"warning",startIcon:e.jsx(Ke,{}),onClick:v,disabled:!k.trim(),children:"Confirmar CancelaciÃ³n"})]})]}),e.jsx(ba,{open:K.open,autoHideDuration:5e3,onClose:()=>L({...K,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"right"},children:e.jsx(ja,{onClose:()=>L({...K,open:!1}),severity:K.severity,variant:"filled",sx:{width:"100%",borderRadius:"8px"},children:K.message})}),e.jsx(Ca,{open:io,onClose:()=>ce(!1),onConfirm:P,title:"Eliminar Clase",content:Z?`Â¿EstÃ¡ seguro de eliminar la clase de ${Z.especialidad} programada para ${Z.dia} de ${Z.hora}?`:"",confirmButtonColor:"#f44336",confirmButtonText:"Eliminar"}),e.jsxs(Pe,{open:Ne,onClose:()=>Se(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(Me,{sx:{bgcolor:"#2196f3",color:"white"},children:e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(wa,{}),"Programaciones de ",Ge," - ",Xe]})}),e.jsx(Be,{sx:{mt:2},children:e.jsx(T,{container:!0,spacing:2,children:qe.map(o=>e.jsx(T,{item:!0,xs:12,children:e.jsxs(We,{elevation:0,sx:{p:1.5,borderLeft:`4px solid ${be(o.especialidad)}`,borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",bgcolor:x(be(o.especialidad),.1),mb:1},children:[e.jsxs(p,{children:[e.jsxs(c,{variant:"subtitle2",sx:{fontWeight:"bold",fontSize:"0.85rem"},children:[o.especialidad,o.estado==="cancelada"&&e.jsx(ee,{label:"CANCELADA",size:"small",color:"error",sx:{ml:.5,fontSize:"0.6rem",height:16,"& .MuiChip-label":{px:.5}}})]}),e.jsxs(c,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.3,fontSize:"0.7rem"},children:[e.jsx(je,{fontSize:"inherit"}),o.profesor]}),e.jsxs(c,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.3,fontSize:"0.7rem"},children:[e.jsx(Ae,{fontSize:"inherit"}),"Aula: ",o.aula]}),e.jsxs(c,{variant:"caption",sx:{display:"flex",alignItems:"center",gap:.3,fontSize:"0.7rem"},children:[e.jsx(ho,{fontSize:"inherit"}),e.jsx(Io,{badgeContent:o.totalBeneficiarios,color:"primary",sx:{"& .MuiBadge-badge":{fontSize:"0.55rem",height:12,minWidth:12}},children:e.jsx(c,{variant:"caption",sx:{fontSize:"0.7rem"},children:"Beneficiarios"})})]})]}),e.jsxs(p,{sx:{display:"flex",gap:.5},children:[B&&e.jsx(se,{size:"small",color:"warning",onClick:d=>{d.stopPropagation(),i(o)},disabled:o.estado==="cancelada",sx:{p:.3,"&:hover":{bgcolor:o.estado==="cancelada"?"transparent":x("#ff9800",.1)},opacity:o.estado==="cancelada"?.3:1},children:e.jsx(Ke,{sx:{fontSize:14}})}),!j&&e.jsxs(e.Fragment,{children:[O&&e.jsx(se,{size:"small",color:"primary",onClick:d=>{d.stopPropagation(),l(o)},disabled:o.estado==="cancelada",sx:{p:.3,"&:hover":{bgcolor:o.estado==="cancelada"?"transparent":x("#1976d2",.1)},opacity:o.estado==="cancelada"?.3:1},children:e.jsx(Co,{sx:{fontSize:14}})}),de&&e.jsx(se,{size:"small",color:"error",onClick:d=>{d.stopPropagation(),r(o)},disabled:o.estado==="cancelada",sx:{p:.3,"&:hover":{bgcolor:o.estado==="cancelada"?"transparent":x("#f44336",.1)},opacity:o.estado==="cancelada"?.3:1},children:e.jsx(vo,{sx:{fontSize:14}})})]})]})]})},o.id))})}),e.jsx(Oe,{sx:{p:2},children:e.jsx(Q,{onClick:()=>Se(!1),children:"Cerrar"})})]}),e.jsx(Ao,{isOpen:so,onClose:()=>ve(!1),onSubmit:_,aulas:ke})]})};export{lr as default};
