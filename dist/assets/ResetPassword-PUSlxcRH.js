import{u as A,a as B,r as o,j as e,B as c,C as g,P,A as R,b as u,T as d,c as v,I as j,V as y,d as b,e as k}from"./index-D2WH0i0l.js";import{y as a}from"./index-D_zGW-_v.js";import{I as C}from"./InputAdornment-RiOQfDiX.js";const N=()=>{const t=A(),[I]=B(),[f,x]=o.useState(!1),[m,w]=o.useState(null),[r,T]=o.useState({newPassword:"",confirmPassword:""}),[i,S]=o.useState({newPassword:!1,confirmPassword:!1}),h=n=>{S(s=>({...s,[n]:!s[n]}))},l=I.get("token");o.useEffect(()=>{if(!l){a.error("Token de restablecimiento no válido"),t("/auth");return}(async()=>{try{const s=await k.verifyResetToken(l);w(s.valid),s.valid||a.error(s.message||"Token inválido o expirado")}catch{w(!1),a.error("Error al verificar el token")}})()},[l,t]);const p=n=>{const{name:s,value:V}=n.target;T(W=>({...W,[s]:V}))},E=()=>r.newPassword?r.newPassword.length<8?(a.error("La contraseña debe tener al menos 8 caracteres"),!1):r.newPassword!==r.confirmPassword?(a.error("Las contraseñas no coinciden"),!1):!0:(a.error("Por favor, ingrese la nueva contraseña"),!1),L=async n=>{if(n.preventDefault(),!!E()){x(!0);try{const s=await k.resetPassword(l,r.newPassword);s.success?(a.success("Contraseña restablecida exitosamente"),window.location.href="/"):a.error(s.message||"Error al restablecer la contraseña")}catch{a.error("Error al restablecer la contraseña")}finally{x(!1)}}};return m===null?e.jsx(c,{sx:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:e.jsx(g,{})}):m===!1?e.jsx(c,{sx:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:e.jsxs(P,{elevation:3,sx:{p:4,width:"100%",maxWidth:400,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(R,{severity:"error",children:"El enlace de restablecimiento es inválido o ha expirado."}),e.jsx(u,{variant:"contained",onClick:()=>t("/"),children:"Volver al Login"})]})}):e.jsx(c,{sx:{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:e.jsxs(P,{elevation:3,sx:{p:4,width:"100%",maxWidth:400,display:"flex",flexDirection:"column",gap:2},children:[e.jsx(d,{variant:"h5",align:"center",gutterBottom:!0,children:"Restablecer Contraseña"}),e.jsx(d,{variant:"body2",align:"center",color:"text.secondary",sx:{mb:2},children:"Ingrese su nueva contraseña"}),e.jsxs("form",{onSubmit:L,children:[e.jsx(v,{fullWidth:!0,label:"Nueva contraseña",name:"newPassword",type:i.newPassword?"text":"password",value:r.newPassword,onChange:p,margin:"normal",required:!0,helperText:e.jsx(c,{component:"div",sx:{display:"flex",flexDirection:"column",gap:.5},children:e.jsx(d,{variant:"caption",color:r.newPassword.length>=8?"success.main":"text.secondary",children:"✓ Mínimo 8 caracteres"})}),InputProps:{endAdornment:e.jsx(C,{position:"end",children:e.jsx(j,{"aria-label":"toggle password visibility",onClick:()=>h("newPassword"),edge:"end",children:i.newPassword?e.jsx(y,{}):e.jsx(b,{})})})}}),e.jsx(v,{fullWidth:!0,label:"Confirmar contraseña",name:"confirmPassword",type:i.confirmPassword?"text":"password",value:r.confirmPassword,onChange:p,margin:"normal",required:!0,helperText:r.confirmPassword&&e.jsx(d,{variant:"caption",color:r.newPassword===r.confirmPassword?"success.main":"error.main",children:r.newPassword===r.confirmPassword?"✓ Las contraseñas coinciden":"✗ Las contraseñas no coinciden"}),InputProps:{endAdornment:e.jsx(C,{position:"end",children:e.jsx(j,{"aria-label":"toggle password visibility",onClick:()=>h("confirmPassword"),edge:"end",children:i.confirmPassword?e.jsx(y,{}):e.jsx(b,{})})})}}),e.jsx(u,{fullWidth:!0,variant:"contained",color:"primary",type:"submit",disabled:f,sx:{mt:3},children:f?e.jsx(g,{size:24}):"Restablecer Contraseña"}),e.jsx(u,{fullWidth:!0,variant:"text",onClick:()=>t("/"),sx:{mt:1},children:"Volver al Login"})]})]})})};export{N as default};
