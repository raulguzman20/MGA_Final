import{r as v,j as e,a0 as q,B as x,T as h,I as U,a1 as X,a2 as _,G as H,a9 as J,b as y,C as K,af as N,c as B,ag as m,P as Q,F as z,S as P,M,x as Y}from"./index-D2WH0i0l.js";import{T as Z,a as f,b as rr,c as $,d as p,e as er}from"./TableRow-CTBWTERd.js";import{C as k}from"./Checkbox-4ec6YfyB.js";import{R as tr,a as ar,S as nr}from"./Switch-qiKByfkr.js";import{F}from"./FormControlLabel-CLvj0mWI.js";const hr=({title:C,subtitle:or,fields:i=[],initialData:d,open:S,onClose:b,onSubmit:E,onClearForm:W,disableBackdropClick:A=!0,disableEscapeKeyDown:R=!0,submitButtonText:D="Guardar Cambios"})=>{const[s,g]=v.useState({}),[o,j]=v.useState({}),[w,I]=v.useState(!1);v.useEffect(()=>{if(S){if(d)g({...d});else if((i==null?void 0:i.length)>0){const r={};i.forEach(a=>{a!=null&&a.id&&(r[a.id]=a.defaultValue||"")}),g(r)}else g({});j({})}},[d,i,S]);const L=(r,a)=>{if(!r)return null;if(r.required&&(a==null||a===""))return`${r.label||"Campo"} es requerido`;if(r.validate&&a!==void 0&&a!==null)try{const n=r.validate(a,s);if(n)return n}catch(n){return console.error("Error in field validation:",n),"Error en la validación"}if(r.validator&&a!==void 0&&a!==null)try{const n=r.validator(a);if(n)return n}catch(n){return console.error("Error in field validation:",n),"Error en la validación"}return null},l=(r,a)=>{if(!r)return;const n={...s,[r]:a};g(n);const c=i==null?void 0:i.find(t=>(t==null?void 0:t.id)===r);if(c!=null&&c.validateOnChange){const t=L(c,a);j(u=>({...u,[r]:t}))}else o[r]&&j(t=>({...t,[r]:null}));if(c!=null&&c.onChange)try{c.onChange(a,n,(t,u)=>{t&&g(T=>({...T,[t]:u}))})}catch(t){console.error("Error in onChange handler:",t)}},O=()=>{const r={};let a=!0;return i!=null&&i.length?(i.forEach(n=>{if(n!=null&&n.id){const c=L(n,s[n.id]);c&&(r[n.id]=c,a=!1)}}),j(r),a):!0},G=async r=>{if(r.preventDefault(),!w)try{if(O())if(I(!0),typeof E=="function"){const a=E(s);a&&typeof a.then=="function"&&await a}else console.error("onSubmit is not a function")}catch(a){console.error("Error in form submission:",a)}finally{I(!1)}},V=r=>{var a,n,c;if(!r||!r.id||!r.type)return null;switch(r.type){case"switch":return e.jsxs(x,{sx:{mb:2},children:[e.jsx(F,{control:e.jsx(nr,{checked:!!s[r.id],onChange:t=>l(r.id,t.target.checked),color:"primary"}),label:r.label,sx:{width:"100%",ml:0,"& .MuiFormControlLabel-label":{flex:1,fontWeight:500}}}),o[r.id]&&e.jsx(m,{error:!0,children:o[r.id]})]},r.id);case"select":return e.jsxs(x,{sx:{mb:2},children:[e.jsx(h,{variant:"body2",sx:{mb:.5,fontWeight:500},children:r.label}),e.jsxs(z,{fullWidth:!0,variant:"outlined",error:!!o[r.id],children:[e.jsxs(P,{value:s[r.id]||"",onChange:t=>l(r.id,t.target.value),displayEmpty:!0,disabled:r.disabled,sx:{borderRadius:"8px","& .MuiOutlinedInput-notchedOutline":{borderColor:o[r.id]?"error.main":"rgba(0, 0, 0, 0.23)"}},children:[e.jsx(M,{value:"",disabled:!0,children:e.jsxs(h,{color:"text.secondary",children:["Seleccionar ",r.label]})}),(a=r.options)==null?void 0:a.map(t=>e.jsx(M,{value:t.value,children:t.label},t.value))]}),o[r.id]&&e.jsx(m,{children:o[r.id]})]})]},r.id);case"multiSelect":return e.jsxs(x,{sx:{mb:2},children:[e.jsx(h,{variant:"body2",sx:{mb:.5,fontWeight:500},children:r.label}),e.jsxs(z,{fullWidth:!0,variant:"outlined",error:!!o[r.id],children:[e.jsx(P,{multiple:!0,value:Array.isArray(s[r.id])?s[r.id]:[],onChange:t=>l(r.id,t.target.value),renderValue:t=>t.join(", "),disabled:r.disabled,children:(n=r.options)==null?void 0:n.map(t=>e.jsxs(M,{value:t.value,children:[e.jsx(k,{checked:Array.isArray(s[r.id])&&s[r.id].indexOf(t.value)>-1}),e.jsx(Y,{primary:t.label})]},t.value))}),o[r.id]&&e.jsx(m,{children:o[r.id]})]})]},r.id);case"checkbox":return e.jsxs(x,{sx:{mb:2},children:[e.jsx(F,{control:e.jsx(k,{checked:!!s[r.id],onChange:t=>l(r.id,t.target.checked),color:"primary",disabled:r.disabled}),label:r.label,sx:{width:"100%",ml:0,"& .MuiFormControlLabel-label":{flex:1,fontWeight:500}}}),o[r.id]&&e.jsx(m,{error:!0,children:o[r.id]})]},r.id);case"radio":return e.jsxs(x,{sx:{mb:2},children:[e.jsx(h,{variant:"body2",sx:{mb:.5,fontWeight:500},children:r.label}),e.jsxs(z,{fullWidth:!0,error:!!o[r.id],children:[e.jsx(tr,{value:s[r.id]||"",onChange:t=>l(r.id,t.target.value),children:(c=r.options)==null?void 0:c.map(t=>e.jsx(F,{value:t.value,control:e.jsx(ar,{color:"primary",disabled:r.disabled}),label:t.label},t.value))}),o[r.id]&&e.jsx(m,{children:o[r.id]})]})]},r.id);case"password":return e.jsxs(x,{sx:{mb:1},children:[e.jsx(h,{variant:"body2",sx:{mb:.5,fontWeight:500},children:r.label}),e.jsx(B,{fullWidth:!0,size:"small",type:"password",value:s[r.id]||"",onChange:t=>l(r.id,t.target.value),variant:"outlined",placeholder:r.placeholder||"",error:!!o[r.id],helperText:o[r.id]||(typeof r.helperText=="function"?r.helperText(s):r.helperText),disabled:r.disabled,InputProps:{inputProps:{maxLength:r.maxLength||void 0},sx:{borderRadius:"8px"}}})]},r.id);case"permissionsTable":return e.jsxs(x,{children:[e.jsx(h,{sx:{mb:.5,color:"#666",fontSize:"0.75rem",textDecoration:"none"},children:r.section}),e.jsx(Z,{component:Q,sx:{mt:.5,"& .MuiTableCell-root":{padding:"1px 2px",fontSize:"0.75rem",height:"24px",lineHeight:"1"},"& .MuiCheckbox-root":{padding:"1px","& .MuiSvgIcon-root":{fontSize:"18px"}}},children:e.jsxs(f,{size:"small",sx:{tableLayout:"fixed"},children:[e.jsx(rr,{children:e.jsxs($,{children:[e.jsx(p,{children:"Módulo"}),e.jsx(p,{align:"center",sx:{width:"60px"},children:"Visualizar"}),e.jsx(p,{align:"center",sx:{width:"60px"},children:"Crear"}),e.jsx(p,{align:"center",sx:{width:"60px"},children:"Editar"}),e.jsx(p,{align:"center",sx:{width:"60px"},children:"Eliminar"})]})}),e.jsx(er,{children:r.modules.map(t=>e.jsxs($,{children:[e.jsx(p,{sx:{whiteSpace:"normal",wordBreak:"break-word"},children:t.label}),["visualizar","crear","editar","eliminar"].map(u=>e.jsx(p,{align:"center",children:e.jsx(k,{size:"small",checked:s[`${t.id}-${u}`]||!1,onChange:T=>l(`${t.id}-${u}`,T.target.checked)})},`${t.id}-${u}`))]},t.id))})]})})]},r.id);case"custom":return e.jsxs(x,{sx:{mb:2},children:[r.render?r.render(s[r.id],t=>l(r.id,t),s):null,o[r.id]&&e.jsx(m,{error:!0,children:o[r.id]})]},r.id);default:return e.jsxs(x,{sx:{mb:1},children:[e.jsx(h,{variant:"body2",sx:{mb:.5,fontWeight:500},children:r.label}),e.jsx(B,{fullWidth:!0,size:"small",type:r.type||"text",value:s[r.id]||"",onChange:t=>l(r.id,t.target.value),variant:"outlined",placeholder:r.placeholder||"",error:!!o[r.id],helperText:o[r.id]||(typeof r.helperText=="function"?r.helperText(s):r.helperText),multiline:r.multiline,rows:r.rows||1,disabled:r.disabled,sx:{...r.sx||{},"& .MuiInputBase-root":r.multiline?{height:"auto !important","& textarea":{whiteSpace:"normal",height:"auto !important",minHeight:`${r.rows*24}px !important`},"& .MuiInputBase-input::placeholder":{whiteSpace:"normal",overflow:"hidden",textOverflow:"ellipsis"}}:{}},InputProps:{inputProps:{min:r.min,max:r.max,maxLength:r.maxLength||void 0,style:{}},sx:{borderRadius:"8px"}}})]},r.id)}};return i!=null&&i.reduce((r,a)=>{const n=(a==null?void 0:a.section)||"default";return r[n]||(r[n]=[]),r[n].push(a),r},{}),e.jsxs(q,{open:S,onClose:(r,a)=>{A&&a==="backdropClick"||R&&a==="escapeKeyDown"||typeof b=="function"&&b()},maxWidth:"md",fullWidth:!0,disableEscapeKeyDown:R,PaperProps:{sx:{borderRadius:"8px",maxHeight:"90vh","& .MuiDialogContent-root":{overflowX:"hidden"}}},children:[e.jsxs(x,{sx:{bgcolor:"#0455a2",color:"white",p:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(h,{variant:"h6",sx:{fontWeight:600,fontSize:"1rem"},children:C}),e.jsx(U,{onClick:b,sx:{color:"white",p:.5},children:e.jsx(X,{})})]}),e.jsxs("form",{onSubmit:G,children:[e.jsx(_,{sx:{p:1,"& .MuiBox-root":{mb:.75},"& .MuiTypography-root":{fontSize:"0.75rem",color:"#555",mb:.25,fontWeight:500},"& .MuiFormControl-root":{mb:.5,"& .MuiInputBase-root":{minHeight:"30px",fontSize:"0.75rem"}},"& .MuiTextField-root":{"& .MuiInputBase-root":{height:"30px",fontSize:"0.75rem","&.MuiInputBase-multiline":{height:"auto !important"}}},"& .MuiSelect-select":{height:"30px !important",minHeight:"30px !important",fontSize:"0.75rem",padding:"2px 8px"},"& .MuiFormControlLabel-root":{marginLeft:0,marginRight:0,minHeight:"30px"},"& .MuiFormControlLabel-label":{fontSize:"0.75rem"},"& .MuiFormHelperText-root":{marginTop:0,fontSize:"0.7rem"}},children:e.jsx(H,{container:!0,spacing:1,children:i==null?void 0:i.filter(r=>(r==null?void 0:r.id)!=="programacion").map(r=>e.jsx(H,{item:!0,xs:12,sm:r!=null&&r.fullWidth?12:6,children:V(r)},r==null?void 0:r.id))})}),e.jsxs(J,{sx:{p:1,bgcolor:"#f5f5f5",gap:1},children:[e.jsx(y,{onClick:b,variant:"outlined",size:"small",sx:{borderRadius:"4px",px:2,py:.5,fontSize:"0.875rem",minHeight:"30px"},children:"Cancelar"}),W&&e.jsx(y,{onClick:W,variant:"outlined",size:"small",sx:{borderRadius:"4px",px:2,py:.5,fontSize:"0.875rem",minHeight:"30px",color:"#f44336",borderColor:"#f44336","&:hover":{borderColor:"#d32f2f",backgroundColor:"rgba(244, 67, 54, 0.04)"}},children:"Limpiar"}),d&&d._id&&C&&C.includes("Usuario")&&e.jsx(y,{onClick:()=>b("assignRoles"),variant:"contained",size:"small",sx:{borderRadius:"4px",px:2,py:.5,fontSize:"0.875rem",bgcolor:"#0455a2",minHeight:"30px"},children:"Asignar Roles"}),e.jsxs(x,{sx:{m:.5,position:"relative"},children:[e.jsx(y,{type:"submit",variant:"contained",size:"small",disabled:w,sx:{borderRadius:"4px",px:2,py:.5,fontSize:"0.875rem",bgcolor:"#0455a2",minHeight:"30px"},children:D}),w&&e.jsx(K,{size:24,sx:{color:N[500],position:"absolute",top:"50%",left:"50%",marginTop:"-12px",marginLeft:"-12px",zIndex:1}})]})]})]})]})};export{hr as F};
