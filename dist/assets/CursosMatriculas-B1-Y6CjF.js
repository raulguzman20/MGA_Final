import{aa as $e,j as r,a3 as _,A as O,r as p,E as u,B as I,P as ve,T as W}from"./index-D2WH0i0l.js";import{G as k}from"./GenericList-CZICF8vs.js";import{D as L}from"./DetailModal-BVuqfkLW.js";import{F as q}from"./FormModal-BqkXggEq.js";import{S}from"./StatusButton-T52DgIHd.js";import{S as ye}from"./SuccessAlert-D_Anh4KD.js";import{T as Ce,a as R}from"./Tabs-CS6fJ3XQ.js";import"./Search-CIHESQ8V.js";import"./NavigateNext-C2-Nd8B6.js";import"./TableRow-CTBWTERd.js";import"./Stack-BupWGgAE.js";import"./Checkbox-4ec6YfyB.js";import"./Switch-qiKByfkr.js";import"./FormControlLabel-CLvj0mWI.js";import"./EventNote-C1bQThfN.js";const H=()=>$e(),Se=({open:c,message:i,onClose:o})=>r.jsx(_,{open:c,autoHideDuration:3e3,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:r.jsx(O,{onClose:o,severity:"error",variant:"filled",sx:{minWidth:"200px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",borderRadius:"8px"},children:i})}),we=({open:c,message:i,onClose:o})=>r.jsx(_,{open:c,autoHideDuration:3e3,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:r.jsx(O,{onClose:o,severity:"info",variant:"filled",sx:{minWidth:"200px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",borderRadius:"8px"},children:i})}),je=({open:c,message:i,onClose:o})=>r.jsx(_,{open:c,autoHideDuration:3e3,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:r.jsx(O,{onClose:o,severity:"warning",variant:"filled",sx:{minWidth:"200px",boxShadow:"0 2px 8px rgba(0,0,0,0.15)",borderRadius:"8px"},children:i})}),Me=({alert:c,onClose:i})=>{const{open:o,type:s,message:b}=c;return{success:r.jsx(ye,{open:o,message:b,onClose:i}),error:r.jsx(Se,{open:o,message:b,onClose:i}),info:r.jsx(we,{open:o,message:b,onClose:i}),warning:r.jsx(je,{open:o,message:b,onClose:i})}[s]||null},De=()=>{const{alert:c,hideAlert:i}=H();return r.jsx(Me,{alert:c,onClose:i})},G=c=>{const{children:i,value:o,index:s,...b}=c;return r.jsx("div",{role:"tabpanel",hidden:o!==s,id:`tabpanel-${s}`,"aria-labelledby":`tab-${s}`,...b,style:{height:"calc(100% - 48px)"},children:o===s&&r.jsx(I,{sx:{height:"100%"},children:i})})},m="http://localhost:3000/api",Ie=()=>{const[c,i]=p.useState(0),{showSuccess:o,showError:s}=H(),[b,P]=p.useState([]),[x,g]=p.useState(null),[U,F]=p.useState(!1),[J,w]=p.useState(!1),[N,j]=p.useState(!1),[T,K]=p.useState([]),[f,E]=p.useState(null),[Q,z]=p.useState(!1),[X,M]=p.useState(!1),[A,D]=p.useState(!1),Y=(e,l)=>{i(l)};p.useEffect(()=>{$(),v()},[]);const $=async()=>{try{const e=await u.get(`${m}/cursos`);P(e.data)}catch(e){s("Error al cargar los cursos"),console.error("Error:",e)}},v=async()=>{try{const e=await u.get(`${m}/matriculas`);K(e.data)}catch(e){s("Error al cargar las matrículas"),console.error("Error:",e)}},Z=[{id:"nombre",label:"Nombre Curso"},{id:"valor_por_hora",label:"Valor por hora",render:e=>`$${e.toLocaleString()}`},{id:"estado",label:"Estado",render:(e,l)=>r.jsx(S,{active:e,onClick:()=>ie(l._id)})}],ee=[{id:"_id",label:"Código"},{id:"nombre",label:"Nombre"},{id:"descripcion",label:"Descripción"},{id:"valor_por_hora",label:"Valor por hora",render:e=>`$${e.toLocaleString()}`},{id:"estado",label:"Estado",render:e=>r.jsx(S,{active:e})}],ae=[{id:"nombre",label:"Nombre Curso",type:"text",required:!0,fullWidth:!0,placeholder:"Ej: Guitarra Clásica Nivel 1"},{id:"descripcion",label:"Descripción",type:"text",required:!0,fullWidth:!0,multiline:!0,rows:3,placeholder:"Descripción detallada del curso",helperText:"Ingrese una descripción detallada del curso"},{id:"valor_por_hora",label:"Valor por hora",type:"number",required:!0,fullWidth:!0,InputProps:{startAdornment:r.jsx(W,{variant:"body2",sx:{mr:1},children:"$"}),inputProps:{min:0}},placeholder:"Ej: 50000"},{id:"estado",label:"Estado",type:"switch",defaultValue:!0}],re=()=>{j(!1),g(null),w(!0)},oe=e=>{j(!0),g(e),w(!0)},te=async e=>{var t;if(window.confirm(`¿Está seguro de eliminar el curso ${e.nombre}?`))try{const a=await u.delete(`${m}/cursos/${e._id}`);a.data.curso?o(a.data.message||`El curso ${e.nombre} ha sido cambiado a inactivo`):o(`El curso ${e.nombre} ha sido eliminado exitosamente`),$()}catch(a){if(console.error("Error al eliminar curso:",a),a.response){if(a.response.status===500)try{await u.put(`${m}/cursos/${e._id}`,{estado:!1}),o(`Se ha cambiado el estado del curso ${e.nombre} a inactivo`),$();return}catch(n){console.error("Error al cambiar estado después de error 500:",n)}s(`Error al eliminar el curso ${e.nombre}: ${((t=a.response.data)==null?void 0:t.message)||a.message}`)}else s(`Error al eliminar el curso ${e.nombre}`)}},se=e=>{g(e),F(!0)},le=()=>{F(!1),g(null)},V=()=>{w(!1),g(null),j(!1)},ne=async e=>{var l,t;try{const a={...e,valor_por_hora:Number(e.valor_por_hora)};if(N){a.hasOwnProperty("estado")&&(a.estado=!!a.estado);try{await u.put(`${m}/cursos/${x._id}`,a),o(`El curso ${x.nombre} ha sido actualizado exitosamente`)}catch(n){if(console.error("Error al actualizar curso:",n),n.response&&n.response.status===400&&n.response.data.message&&(n.response.data.message.includes("asociada a una venta")||n.response.data.message.includes("asociado a una venta")))if(Object.keys(a).length===1&&a.hasOwnProperty("estado")||a.hasOwnProperty("estado"))try{await u.put(`${m}/cursos/${x._id}`,{estado:!!a.estado}),o(`Estado del curso ${x.nombre} ${a.estado?"activado":"desactivado"} exitosamente`)}catch(y){console.error("Error al actualizar solo el estado:",y),s("No se pudo actualizar el estado del curso");return}else{s("No se puede modificar el curso porque está asociado a una venta. Solo se permite modificar el estado.");return}else{s(`Error al actualizar el curso: ${((t=(l=n.response)==null?void 0:l.data)==null?void 0:t.message)||n.message}`);return}}}else await u.post(`${m}/cursos`,a),o("El curso ha sido creado exitosamente");$(),V()}catch(a){s("Error al procesar el formulario del curso"),console.error("Error:",a)}},ie=async e=>{var l;try{const t=b.find(n=>n._id===e),a=!t.estado;await u.put(`${m}/cursos/${e}`,{estado:!!a}),o(`Estado del curso ${t.nombre} ${a?"activado":"desactivado"} exitosamente`),$()}catch(t){console.error("Error al cambiar el estado del curso:",t),t.response?s(`Error al cambiar el estado del curso: ${((l=t.response.data)==null?void 0:l.message)||t.message}`):s("Error al cambiar el estado del curso")}},ce=[{id:"nombre",label:"Nombre Matrícula"},{id:"valorMatricula",label:"Valor Matrícula",render:e=>`$${e.toLocaleString()}`},{id:"estado",label:"Estado",render:(e,l)=>r.jsx(S,{active:e,onClick:()=>ge(l._id)})}],de=[{id:"_id",label:"Código"},{id:"nombre",label:"Nombre"},{id:"valorMatricula",label:"Valor Matrícula",render:e=>`$${e.toLocaleString()}`},{id:"estado",label:"Estado",render:e=>r.jsx(S,{active:e})}],ue=[{id:"nombre",label:"Nombre Matrícula",type:"text",required:!0,fullWidth:!0,placeholder:"Ej: Matrícula Básica"},{id:"valorMatricula",label:"Valor Matrícula",type:"number",required:!0,fullWidth:!0,InputProps:{startAdornment:r.jsx(W,{variant:"body2",sx:{mr:1},children:"$"}),inputProps:{min:0}},placeholder:"Ej: 50000"},{id:"estado",label:"Estado",type:"switch",defaultValue:!0}],me=()=>{D(!1),E(null),M(!0)},pe=e=>{D(!0),E(e),M(!0)},he=async e=>{var t;if(window.confirm(`¿Está seguro de eliminar la matrícula ${e.nombre}?`))try{const a=await u.delete(`${m}/matriculas/${e._id}`);a.data.matricula?o(a.data.message||`La matrícula ${e.nombre} ha sido cambiada a inactivo`):o(`La matrícula ${e.nombre} ha sido eliminada exitosamente`),v()}catch(a){if(console.error("Error al eliminar matrícula:",a),a.response){if(a.response.status===500)try{await u.put(`${m}/matriculas/${e._id}`,{estado:!1}),o(`Se ha cambiado el estado de la matrícula ${e.nombre} a inactivo`),v();return}catch(n){console.error("Error al cambiar estado después de error 500:",n)}s(`Error al eliminar la matrícula ${e.nombre}: ${((t=a.response.data)==null?void 0:t.message)||a.message}`)}else s(`Error al eliminar la matrícula ${e.nombre}`)}},be=e=>{E(e),z(!0)},xe=()=>{z(!1),E(null)},B=()=>{M(!1),E(null),D(!1)},fe=async e=>{var l,t,a,n;try{const C=["nombre","valorMatricula","estado"],y={};C.forEach(d=>{e.hasOwnProperty(d)&&(y[d]=e[d])});const h={...y,valorMatricula:Number(y.valorMatricula)};if(A){h.hasOwnProperty("estado")&&(h.estado=!!h.estado);try{await u.put(`${m}/matriculas/${f._id}`,h),o("La matrícula ha sido actualizada exitosamente")}catch(d){if(console.error("Error al actualizar matrícula:",d),console.error("Error response:",(l=d.response)==null?void 0:l.data),console.error("Error status:",(t=d.response)==null?void 0:t.status),console.error("Datos enviados:",h),d.response&&d.response.status===400&&d.response.data.message&&(d.response.data.message.includes("asociada a una venta")||d.response.data.message.includes("asociado a una venta")))if(Object.keys(h).length===1&&h.hasOwnProperty("estado")||h.hasOwnProperty("estado"))try{await u.put(`${m}/matriculas/${f._id}`,{estado:!!h.estado}),o(`Estado de la matrícula ${h.estado?"activada":"desactivada"} exitosamente`)}catch(Ee){console.error("Error al actualizar solo el estado:",Ee),s("No se pudo actualizar el estado de la matrícula");return}else{s("No se puede modificar la matrícula porque está asociada a una venta. Solo se permite modificar el estado.");return}else{s(`Error al actualizar la matrícula: ${((n=(a=d.response)==null?void 0:a.data)==null?void 0:n.message)||d.message}`);return}}}else await u.post(`${m}/matriculas`,h),o("La matrícula ha sido creada exitosamente");v(),B()}catch(C){s("Error al procesar el formulario de matrícula"),console.error("Error:",C)}},ge=async e=>{var l;try{const t=T.find(n=>n._id===e),a=!t.estado;await u.put(`${m}/matriculas/${e}`,{estado:!!a}),o(`Estado de la matrícula ${t.nombre} ${a?"activada":"desactivada"} exitosamente`),v()}catch(t){console.error("Error al cambiar el estado de la matrícula:",t),t.response?s(`Error al cambiar el estado de la matrícula: ${((l=t.response.data)==null?void 0:l.message)||t.message}`):s("Error al cambiar el estado de la matrícula")}};return r.jsxs(I,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:"column"},children:[r.jsx(De,{}),r.jsx(ve,{sx:{borderBottom:0,borderColor:"transparent",mb:2,boxShadow:"none",backgroundColor:"transparent"},children:r.jsxs(Ce,{value:c,onChange:Y,variant:"standard",sx:{"& .MuiTab-root":{fontWeight:"bold",fontSize:"0.9rem",color:"#555",textTransform:"uppercase",minWidth:"120px",minHeight:"36px",padding:"6px 12px",marginRight:"8px",marginTop:"8px",marginBottom:"8px",borderRadius:"4px",transition:"all 0.3s ease",border:"1px solid #ddd",backgroundColor:"transparent"},"& .Mui-selected":{color:"#fff !important",backgroundColor:"#0455a2",boxShadow:"0 2px 5px rgba(0,0,0,0.2)"},"& .MuiTabs-indicator":{display:"none"}},children:[r.jsx(R,{label:"Cursos",id:"tab-0","aria-controls":"tabpanel-0",sx:{"&:hover":{backgroundColor:"rgba(4, 85, 162, 0.05)"}}}),r.jsx(R,{label:"Matrículas",id:"tab-1","aria-controls":"tabpanel-1",sx:{"&:hover":{backgroundColor:"rgba(4, 85, 162, 0.05)"}}})]})}),r.jsxs(G,{value:c,index:0,children:[r.jsx(k,{data:b,columns:Z,onEdit:oe,onDelete:te,onCreate:re,onView:se,title:"Gestión de Cursos"}),r.jsx(L,{title:`Detalle del Curso: ${x==null?void 0:x.nombre}`,data:x,fields:ee,open:U,onClose:le}),r.jsx(q,{title:N?"Editar Curso":"Crear Nuevo Curso",fields:ae,initialData:x,open:J,onClose:V,onSubmit:ne,maxWidth:"md"})]}),r.jsxs(G,{value:c,index:1,children:[r.jsx(k,{data:T,columns:ce,onEdit:pe,onDelete:he,onCreate:me,onView:be,title:"Gestión de Matrículas"}),r.jsx(L,{title:`Detalle de Matrícula: ${f==null?void 0:f.nombre}`,data:f,fields:de,open:Q,onClose:xe}),r.jsx(q,{title:A?"Editar Matrícula":"Crear Nueva Matrícula",fields:ue,initialData:f,open:X,onClose:B,onSubmit:fe})]})]})};export{Ie as default};
